{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/lib/ai/models.ts"],"sourcesContent":["// Define your models here.\n\nexport interface Model {\n  id: string;\n  label: string;\n  apiIdentifier: string;\n  description: string;\n}\n\nexport const models: Array<Model> = [\n  {\n    id: 'gpt-4o-mini',\n    label: 'Star Trader',\n    apiIdentifier: 'gpt-4o-mini',\n    description: 'Star Trader - For all your Star Citizen Trading Needs.',\n  },\n] as const;\n\nexport const DEFAULT_MODEL_NAME: string = 'gpt-4o-mini';\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AASpB,MAAM,SAAuB;IAClC;QACE,IAAI;QACJ,OAAO;QACP,eAAe;QACf,aAAa;IACf;CACD;AAEM,MAAM,qBAA6B"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/model-selector.tsx"],"sourcesContent":["'use client';\n\nimport { startTransition, useMemo, useOptimistic, useState } from 'react';\n\nimport { saveModelId } from '@/app/(chat)/actions';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { models } from '@/lib/ai/models';\nimport { cn } from '@/lib/utils';\n\nimport { CheckCircleFillIcon, ChevronDownIcon } from './icons';\n\nexport function ModelSelector({\n  selectedModelId,\n  className,\n}: {\n  selectedModelId: string;\n} & React.ComponentProps<typeof Button>) {\n  const [open, setOpen] = useState(false);\n  const [optimisticModelId, setOptimisticModelId] =\n    useOptimistic(selectedModelId);\n\n  const selectedModel = useMemo(\n    () => models.find((model) => model.id === optimisticModelId),\n    [optimisticModelId],\n  );\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger\n        asChild\n        className={cn(\n          'w-fit data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n          className,\n        )}\n      >\n        <Button variant=\"outline\" className=\"md:px-2 md:h-[34px]\">\n          {selectedModel?.label}\n          <ChevronDownIcon />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"start\" className=\"min-w-[300px]\">\n        {models.map((model) => (\n          <DropdownMenuItem\n            key={model.id}\n            onSelect={() => {\n              setOpen(false);\n\n              startTransition(() => {\n                setOptimisticModelId(model.id);\n                saveModelId(model.id);\n              });\n            }}\n            className=\"gap-4 group/item flex flex-row justify-between items-center\"\n            data-active={model.id === optimisticModelId}\n          >\n            <div className=\"flex flex-col gap-1 items-start\">\n              {model.label}\n              {model.description && (\n                <div className=\"text-xs text-muted-foreground\">\n                  {model.description}\n                </div>\n              )}\n            </div>\n            <div className=\"text-foreground dark:text-foreground opacity-0 group-data-[active=true]/item:opacity-100\">\n              <CheckCircleFillIcon />\n            </div>\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;AACA;AAMA;AACA;AAEA;;;AAfA;;;;;;;;AAiBO,SAAS,cAAc,EAC5B,eAAe,EACf,SAAS,EAG4B;;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,mBAAmB,qBAAqB,GAC7C,CAAA,GAAA,6KAAA,CAAA,gBAAa,AAAD,EAAE;IAEhB,MAAM,gBAAgB,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD;gDAC1B,IAAM,sHAAA,CAAA,SAAM,CAAC,IAAI;wDAAC,CAAC,QAAU,MAAM,EAAE,KAAK;;+CAC1C;QAAC;KAAkB;IAGrB,qBACE,6MAAC,wIAAA,CAAA,eAAY;QAAC,MAAM;QAAM,cAAc;;0BACtC,6MAAC,wIAAA,CAAA,sBAAmB;gBAClB,OAAO;gBACP,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,8EACA;0BAGF,cAAA,6MAAC,8HAAA,CAAA,SAAM;oBAAC,SAAQ;oBAAU,WAAU;;wBACjC,eAAe;sCAChB,6MAAC,uHAAA,CAAA,kBAAe;;;;;;;;;;;;;;;;0BAGpB,6MAAC,wIAAA,CAAA,sBAAmB;gBAAC,OAAM;gBAAQ,WAAU;0BAC1C,sHAAA,CAAA,SAAM,CAAC,GAAG,CAAC,CAAC,sBACX,6MAAC,wIAAA,CAAA,mBAAgB;wBAEf,UAAU;4BACR,QAAQ;4BAER,CAAA,GAAA,6KAAA,CAAA,kBAAe,AAAD,EAAE;gCACd,qBAAqB,MAAM,EAAE;gCAC7B,CAAA,GAAA,6HAAA,CAAA,cAAW,AAAD,EAAE,MAAM,EAAE;4BACtB;wBACF;wBACA,WAAU;wBACV,eAAa,MAAM,EAAE,KAAK;;0CAE1B,6MAAC;gCAAI,WAAU;;oCACZ,MAAM,KAAK;oCACX,MAAM,WAAW,kBAChB,6MAAC;wCAAI,WAAU;kDACZ,MAAM,WAAW;;;;;;;;;;;;0CAIxB,6MAAC;gCAAI,WAAU;0CACb,cAAA,6MAAC,uHAAA,CAAA,sBAAmB;;;;;;;;;;;uBArBjB,MAAM,EAAE;;;;;;;;;;;;;;;;AA4BzB;GA5DgB;;QAQZ,6KAAA,CAAA,gBAAa;;;KARD"}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/sidebar-toggle.tsx"],"sourcesContent":["import type { ComponentProps } from 'react';\n\nimport { type SidebarTrigger, useSidebar } from '@/components/ui/sidebar';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\n\nimport { SidebarLeftIcon } from './icons';\nimport { Button } from './ui/button';\n\nexport function SidebarToggle({\n  className,\n}: ComponentProps<typeof SidebarTrigger>) {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <Button\n          onClick={toggleSidebar}\n          variant=\"outline\"\n          className=\"md:px-2 md:h-fit\"\n        >\n          <SidebarLeftIcon size={16} />\n        </Button>\n      </TooltipTrigger>\n      <TooltipContent align=\"start\">Toggle Sidebar</TooltipContent>\n    </Tooltip>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAMA;AACA;;;;;;;AAEO,SAAS,cAAc,EAC5B,SAAS,EAC6B;;IACtC,MAAM,EAAE,aAAa,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,aAAU,AAAD;IAEnC,qBACE,6MAAC,+HAAA,CAAA,UAAO;;0BACN,6MAAC,+HAAA,CAAA,iBAAc;gBAAC,OAAO;0BACrB,cAAA,6MAAC,8HAAA,CAAA,SAAM;oBACL,SAAS;oBACT,SAAQ;oBACR,WAAU;8BAEV,cAAA,6MAAC,uHAAA,CAAA,kBAAe;wBAAC,MAAM;;;;;;;;;;;;;;;;0BAG3B,6MAAC,+HAAA,CAAA,iBAAc;gBAAC,OAAM;0BAAQ;;;;;;;;;;;;AAGpC;GAnBgB;;QAGY,+HAAA,CAAA,aAAU;;;KAHtB"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/visibility-selector.tsx"],"sourcesContent":["'use client';\n\nimport { ReactNode, useMemo, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { cn } from '@/lib/utils';\n\nimport {\n  CheckCircleFillIcon,\n  ChevronDownIcon,\n  GlobeIcon,\n  LockIcon,\n} from './icons';\nimport { useChatVisibility } from '@/hooks/use-chat-visibility';\n\nexport type VisibilityType = 'private' | 'public';\n\nconst visibilities: Array<{\n  id: VisibilityType;\n  label: string;\n  description: string;\n  icon: ReactNode;\n}> = [\n  {\n    id: 'private',\n    label: 'Private',\n    description: 'Only you can access this chat',\n    icon: <LockIcon />,\n  },\n  {\n    id: 'public',\n    label: 'Public',\n    description: 'Anyone with the link can access this chat',\n    icon: <GlobeIcon />,\n  },\n];\n\nexport function VisibilitySelector({\n  chatId,\n  className,\n  selectedVisibilityType,\n}: {\n  chatId: string;\n  selectedVisibilityType: VisibilityType;\n} & React.ComponentProps<typeof Button>) {\n  const [open, setOpen] = useState(false);\n\n  const { visibilityType, setVisibilityType } = useChatVisibility({\n    chatId,\n    initialVisibility: selectedVisibilityType,\n  });\n\n  const selectedVisibility = useMemo(\n    () => visibilities.find((visibility) => visibility.id === visibilityType),\n    [visibilityType],\n  );\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger\n        asChild\n        className={cn(\n          'w-fit data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n          className,\n        )}\n      >\n        <Button\n          variant=\"outline\"\n          className=\"hidden md:flex md:px-2 md:h-[34px]\"\n        >\n          {selectedVisibility?.icon}\n          {selectedVisibility?.label}\n          <ChevronDownIcon />\n        </Button>\n      </DropdownMenuTrigger>\n\n      <DropdownMenuContent align=\"start\" className=\"min-w-[300px]\">\n        {visibilities.map((visibility) => (\n          <DropdownMenuItem\n            key={visibility.id}\n            onSelect={() => {\n              setVisibilityType(visibility.id);\n              setOpen(false);\n            }}\n            className=\"gap-4 group/item flex flex-row justify-between items-center\"\n            data-active={visibility.id === visibilityType}\n          >\n            <div className=\"flex flex-col gap-1 items-start\">\n              {visibility.label}\n              {visibility.description && (\n                <div className=\"text-xs text-muted-foreground\">\n                  {visibility.description}\n                </div>\n              )}\n            </div>\n            <div className=\"text-foreground dark:text-foreground opacity-0 group-data-[active=true]/item:opacity-100\">\n              <CheckCircleFillIcon />\n            </div>\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAMA;AAEA;AAMA;;;AAlBA;;;;;;;AAsBA,MAAM,eAKD;IACH;QACE,IAAI;QACJ,OAAO;QACP,aAAa;QACb,oBAAM,6MAAC,uHAAA,CAAA,WAAQ;;;;;IACjB;IACA;QACE,IAAI;QACJ,OAAO;QACP,aAAa;QACb,oBAAM,6MAAC,uHAAA,CAAA,YAAS;;;;;IAClB;CACD;AAEM,SAAS,mBAAmB,EACjC,MAAM,EACN,SAAS,EACT,sBAAsB,EAIe;;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAE;IAEjC,MAAM,EAAE,cAAc,EAAE,iBAAiB,EAAE,GAAG,CAAA,GAAA,qIAAA,CAAA,oBAAiB,AAAD,EAAE;QAC9D;QACA,mBAAmB;IACrB;IAEA,MAAM,qBAAqB,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD;0DAC/B,IAAM,aAAa,IAAI;kEAAC,CAAC,aAAe,WAAW,EAAE,KAAK;;yDAC1D;QAAC;KAAe;IAGlB,qBACE,6MAAC,wIAAA,CAAA,eAAY;QAAC,MAAM;QAAM,cAAc;;0BACtC,6MAAC,wIAAA,CAAA,sBAAmB;gBAClB,OAAO;gBACP,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,8EACA;0BAGF,cAAA,6MAAC,8HAAA,CAAA,SAAM;oBACL,SAAQ;oBACR,WAAU;;wBAET,oBAAoB;wBACpB,oBAAoB;sCACrB,6MAAC,uHAAA,CAAA,kBAAe;;;;;;;;;;;;;;;;0BAIpB,6MAAC,wIAAA,CAAA,sBAAmB;gBAAC,OAAM;gBAAQ,WAAU;0BAC1C,aAAa,GAAG,CAAC,CAAC,2BACjB,6MAAC,wIAAA,CAAA,mBAAgB;wBAEf,UAAU;4BACR,kBAAkB,WAAW,EAAE;4BAC/B,QAAQ;wBACV;wBACA,WAAU;wBACV,eAAa,WAAW,EAAE,KAAK;;0CAE/B,6MAAC;gCAAI,WAAU;;oCACZ,WAAW,KAAK;oCAChB,WAAW,WAAW,kBACrB,6MAAC;wCAAI,WAAU;kDACZ,WAAW,WAAW;;;;;;;;;;;;0CAI7B,6MAAC;gCAAI,WAAU;0CACb,cAAA,6MAAC,uHAAA,CAAA,sBAAmB;;;;;;;;;;;uBAjBjB,WAAW,EAAE;;;;;;;;;;;;;;;;AAwB9B;GAlEgB;;QAUgC,qIAAA,CAAA,oBAAiB;;;KAVjD"}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 403, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/chat-header.tsx"],"sourcesContent":["'use client';\n\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { useWindowSize } from 'usehooks-ts';\n\nimport { ModelSelector } from '@/components/model-selector';\nimport { SidebarToggle } from '@/components/sidebar-toggle';\nimport { Button } from '@/components/ui/button';\nimport { PlusIcon, VercelIcon } from './icons';\nimport { useSidebar } from './ui/sidebar';\nimport { memo } from 'react';\nimport { Tooltip, TooltipContent, TooltipTrigger } from './ui/tooltip';\nimport { VisibilityType, VisibilitySelector } from './visibility-selector';\n\nfunction PureChatHeader({\n  chatId,\n  selectedModelId,\n  selectedVisibilityType,\n  isReadonly,\n}: {\n  chatId: string;\n  selectedModelId: string;\n  selectedVisibilityType: VisibilityType;\n  isReadonly: boolean;\n}) {\n  const router = useRouter();\n  const { open } = useSidebar();\n\n  const { width: windowWidth } = useWindowSize();\n\n  return (\n    <header className=\"flex sticky top-0 bg-background py-1.5 items-center px-2 md:px-2 gap-2\">\n      <SidebarToggle />\n\n      {(!open || windowWidth < 768) && (\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"outline\"\n              className=\"order-2 md:order-1 md:px-2 px-2 md:h-fit ml-auto md:ml-0\"\n              onClick={() => {\n                router.push('/');\n                router.refresh();\n              }}\n            >\n              <PlusIcon />\n              <span className=\"md:sr-only\">New Chat</span>\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>New Chat</TooltipContent>\n        </Tooltip>\n      )}\n\n      {!isReadonly && (\n        <ModelSelector\n          selectedModelId={selectedModelId}\n          className=\"order-1 md:order-2\"\n        />\n      )}\n\n      {!isReadonly && (\n        <VisibilitySelector\n          chatId={chatId}\n          selectedVisibilityType={selectedVisibilityType}\n          className=\"order-1 md:order-3\"\n        />\n      )}\n\n      <Button\n        className=\"bg-zinc-900 dark:bg-zinc-100 hover:bg-zinc-800 dark:hover:bg-zinc-200 text-zinc-50 dark:text-zinc-900 hidden md:flex py-1.5 px-2 h-fit md:h-[34px] order-4 md:ml-auto\"\n        asChild\n      >\n        <Link\n          href=\"https://ko-fi.com/danielvnz\"\n          target=\"_noblank\"\n        >\n          💚 Donate\n        </Link>\n      </Button>\n    </header>\n  );\n}\n\nexport const ChatHeader = memo(PureChatHeader, (prevProps, nextProps) => {\n  return prevProps.selectedModelId === nextProps.selectedModelId;\n});\n"],"names":[],"mappings":";;;;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;AAJA;;;;;;;;;;;;AAeA,SAAS,eAAe,EACtB,MAAM,EACN,eAAe,EACf,sBAAsB,EACtB,UAAU,EAMX;;IACC,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,+HAAA,CAAA,aAAU,AAAD;IAE1B,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,CAAA,GAAA,kJAAA,CAAA,gBAAa,AAAD;IAE3C,qBACE,6MAAC;QAAO,WAAU;;0BAChB,6MAAC,mIAAA,CAAA,gBAAa;;;;;YAEb,CAAC,CAAC,QAAQ,cAAc,GAAG,mBAC1B,6MAAC,+HAAA,CAAA,UAAO;;kCACN,6MAAC,+HAAA,CAAA,iBAAc;wBAAC,OAAO;kCACrB,cAAA,6MAAC,8HAAA,CAAA,SAAM;4BACL,SAAQ;4BACR,WAAU;4BACV,SAAS;gCACP,OAAO,IAAI,CAAC;gCACZ,OAAO,OAAO;4BAChB;;8CAEA,6MAAC,uHAAA,CAAA,WAAQ;;;;;8CACT,6MAAC;oCAAK,WAAU;8CAAa;;;;;;;;;;;;;;;;;kCAGjC,6MAAC,+HAAA,CAAA,iBAAc;kCAAC;;;;;;;;;;;;YAInB,CAAC,4BACA,6MAAC,mIAAA,CAAA,gBAAa;gBACZ,iBAAiB;gBACjB,WAAU;;;;;;YAIb,CAAC,4BACA,6MAAC,wIAAA,CAAA,qBAAkB;gBACjB,QAAQ;gBACR,wBAAwB;gBACxB,WAAU;;;;;;0BAId,6MAAC,8HAAA,CAAA,SAAM;gBACL,WAAU;gBACV,OAAO;0BAEP,cAAA,6MAAC,+JAAA,CAAA,UAAI;oBACH,MAAK;oBACL,QAAO;8BACR;;;;;;;;;;;;;;;;;AAMT;GAnES;;QAWQ,qIAAA,CAAA,YAAS;QACP,+HAAA,CAAA,aAAU;QAEI,kJAAA,CAAA,gBAAa;;;KAdrC;AAqEF,MAAM,2BAAa,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAAE,gBAAgB,CAAC,WAAW;IACzD,OAAO,UAAU,eAAe,KAAK,UAAU,eAAe;AAChE"}},
    {"offset": {"line": 553, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 559, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/lib/editor/diff.js"],"sourcesContent":["// Modified from https://github.com/hamflx/prosemirror-diff/blob/master/src/diff.js\n\nimport { diff_match_patch } from 'diff-match-patch';\nimport { Fragment, Node } from 'prosemirror-model';\n\nexport const DiffType = {\n  Unchanged: 0,\n  Deleted: -1,\n  Inserted: 1,\n};\n\nexport const patchDocumentNode = (schema, oldNode, newNode) => {\n  assertNodeTypeEqual(oldNode, newNode);\n\n  const finalLeftChildren = [];\n  const finalRightChildren = [];\n\n  const oldChildren = normalizeNodeContent(oldNode);\n  const newChildren = normalizeNodeContent(newNode);\n  const oldChildLen = oldChildren.length;\n  const newChildLen = newChildren.length;\n  const minChildLen = Math.min(oldChildLen, newChildLen);\n\n  let left = 0;\n  let right = 0;\n\n  for (; left < minChildLen; left++) {\n    const oldChild = oldChildren[left];\n    const newChild = newChildren[left];\n    if (!isNodeEqual(oldChild, newChild)) {\n      break;\n    }\n    finalLeftChildren.push(...ensureArray(oldChild));\n  }\n\n  for (; right + left + 1 < minChildLen; right++) {\n    const oldChild = oldChildren[oldChildLen - right - 1];\n    const newChild = newChildren[newChildLen - right - 1];\n    if (!isNodeEqual(oldChild, newChild)) {\n      break;\n    }\n    finalRightChildren.unshift(...ensureArray(oldChild));\n  }\n\n  const diffOldChildren = oldChildren.slice(left, oldChildLen - right);\n  const diffNewChildren = newChildren.slice(left, newChildLen - right);\n\n  if (diffOldChildren.length && diffNewChildren.length) {\n    const matchedNodes = matchNodes(\n      schema,\n      diffOldChildren,\n      diffNewChildren,\n    ).sort((a, b) => b.count - a.count);\n    const bestMatch = matchedNodes[0];\n    if (bestMatch) {\n      const { oldStartIndex, newStartIndex, oldEndIndex, newEndIndex } =\n        bestMatch;\n      const oldBeforeMatchChildren = diffOldChildren.slice(0, oldStartIndex);\n      const newBeforeMatchChildren = diffNewChildren.slice(0, newStartIndex);\n\n      finalLeftChildren.push(\n        ...patchRemainNodes(\n          schema,\n          oldBeforeMatchChildren,\n          newBeforeMatchChildren,\n        ),\n      );\n      finalLeftChildren.push(\n        ...diffOldChildren.slice(oldStartIndex, oldEndIndex),\n      );\n\n      const oldAfterMatchChildren = diffOldChildren.slice(oldEndIndex);\n      const newAfterMatchChildren = diffNewChildren.slice(newEndIndex);\n\n      finalRightChildren.unshift(\n        ...patchRemainNodes(\n          schema,\n          oldAfterMatchChildren,\n          newAfterMatchChildren,\n        ),\n      );\n    } else {\n      finalLeftChildren.push(\n        ...patchRemainNodes(schema, diffOldChildren, diffNewChildren),\n      );\n    }\n  } else {\n    finalLeftChildren.push(\n      ...patchRemainNodes(schema, diffOldChildren, diffNewChildren),\n    );\n  }\n\n  return createNewNode(oldNode, [...finalLeftChildren, ...finalRightChildren]);\n};\n\nconst matchNodes = (schema, oldChildren, newChildren) => {\n  const matches = [];\n  for (\n    let oldStartIndex = 0;\n    oldStartIndex < oldChildren.length;\n    oldStartIndex++\n  ) {\n    const oldStartNode = oldChildren[oldStartIndex];\n    const newStartIndex = findMatchNode(newChildren, oldStartNode);\n\n    if (newStartIndex !== -1) {\n      let oldEndIndex = oldStartIndex + 1;\n      let newEndIndex = newStartIndex + 1;\n      for (\n        ;\n        oldEndIndex < oldChildren.length && newEndIndex < newChildren.length;\n        oldEndIndex++, newEndIndex++\n      ) {\n        const oldEndNode = oldChildren[oldEndIndex];\n        if (!isNodeEqual(newChildren[newEndIndex], oldEndNode)) {\n          break;\n        }\n      }\n      matches.push({\n        oldStartIndex,\n        newStartIndex,\n        oldEndIndex,\n        newEndIndex,\n        count: newEndIndex - newStartIndex,\n      });\n    }\n  }\n  return matches;\n};\n\nconst findMatchNode = (children, node, startIndex = 0) => {\n  for (let i = startIndex; i < children.length; i++) {\n    if (isNodeEqual(children[i], node)) {\n      return i;\n    }\n  }\n  return -1;\n};\n\nconst patchRemainNodes = (schema, oldChildren, newChildren) => {\n  const finalLeftChildren = [];\n  const finalRightChildren = [];\n  const oldChildLen = oldChildren.length;\n  const newChildLen = newChildren.length;\n  let left = 0;\n  let right = 0;\n  while (oldChildLen - left - right > 0 && newChildLen - left - right > 0) {\n    const leftOldNode = oldChildren[left];\n    const leftNewNode = newChildren[left];\n    const rightOldNode = oldChildren[oldChildLen - right - 1];\n    const rightNewNode = newChildren[newChildLen - right - 1];\n    let updateLeft =\n      !isTextNode(leftOldNode) && matchNodeType(leftOldNode, leftNewNode);\n    let updateRight =\n      !isTextNode(rightOldNode) && matchNodeType(rightOldNode, rightNewNode);\n    if (Array.isArray(leftOldNode) && Array.isArray(leftNewNode)) {\n      finalLeftChildren.push(\n        ...patchTextNodes(schema, leftOldNode, leftNewNode),\n      );\n      left += 1;\n      continue;\n    }\n\n    if (updateLeft && updateRight) {\n      const equalityLeft = computeChildEqualityFactor(leftOldNode, leftNewNode);\n      const equalityRight = computeChildEqualityFactor(\n        rightOldNode,\n        rightNewNode,\n      );\n      if (equalityLeft < equalityRight) {\n        updateLeft = false;\n      } else {\n        updateRight = false;\n      }\n    }\n    if (updateLeft) {\n      finalLeftChildren.push(\n        patchDocumentNode(schema, leftOldNode, leftNewNode),\n      );\n      left += 1;\n    } else if (updateRight) {\n      finalRightChildren.unshift(\n        patchDocumentNode(schema, rightOldNode, rightNewNode),\n      );\n      right += 1;\n    } else {\n      // Delete and insert\n      finalLeftChildren.push(\n        createDiffNode(schema, leftOldNode, DiffType.Deleted),\n      );\n      finalLeftChildren.push(\n        createDiffNode(schema, leftNewNode, DiffType.Inserted),\n      );\n      left += 1;\n    }\n  }\n\n  const deleteNodeLen = oldChildLen - left - right;\n  const insertNodeLen = newChildLen - left - right;\n  if (deleteNodeLen) {\n    finalLeftChildren.push(\n      ...oldChildren\n        .slice(left, left + deleteNodeLen)\n        .flat()\n        .map((node) => createDiffNode(schema, node, DiffType.Deleted)),\n    );\n  }\n\n  if (insertNodeLen) {\n    finalRightChildren.unshift(\n      ...newChildren\n        .slice(left, left + insertNodeLen)\n        .flat()\n        .map((node) => createDiffNode(schema, node, DiffType.Inserted)),\n    );\n  }\n\n  return [...finalLeftChildren, ...finalRightChildren];\n};\n\n// Updated function to perform sentence-level diffs\nexport const patchTextNodes = (schema, oldNode, newNode) => {\n  const dmp = new diff_match_patch();\n\n  // Concatenate the text from the text nodes\n  const oldText = oldNode.map((n) => getNodeText(n)).join('');\n  const newText = newNode.map((n) => getNodeText(n)).join('');\n\n  // Tokenize the text into sentences\n  const oldSentences = tokenizeSentences(oldText);\n  const newSentences = tokenizeSentences(newText);\n\n  // Map sentences to unique characters\n  const { chars1, chars2, lineArray } = sentencesToChars(\n    oldSentences,\n    newSentences,\n  );\n\n  // Perform the diff\n  let diffs = dmp.diff_main(chars1, chars2, false);\n\n  // Convert back to sentences\n  diffs = diffs.map(([type, text]) => {\n    const sentences = text\n      .split('')\n      .map((char) => lineArray[char.charCodeAt(0)]);\n    return [type, sentences];\n  });\n\n  // Map diffs to nodes\n  const res = diffs.flatMap(([type, sentences]) => {\n    return sentences.map((sentence) => {\n      const node = createTextNode(\n        schema,\n        sentence,\n        type !== DiffType.Unchanged ? [createDiffMark(schema, type)] : [],\n      );\n      return node;\n    });\n  });\n\n  return res;\n};\n\n// Function to tokenize text into sentences\nconst tokenizeSentences = (text) => {\n  return text.match(/[^.!?]+[.!?]*\\s*/g) || [];\n};\n\n// Function to map sentences to unique characters\nconst sentencesToChars = (oldSentences, newSentences) => {\n  const lineArray = [];\n  const lineHash = {};\n  let lineStart = 0;\n\n  const chars1 = oldSentences\n    .map((sentence) => {\n      const line = sentence;\n      if (line in lineHash) {\n        return String.fromCharCode(lineHash[line]);\n      }\n      lineHash[line] = lineStart;\n      lineArray[lineStart] = line;\n      lineStart++;\n      return String.fromCharCode(lineHash[line]);\n    })\n    .join('');\n\n  const chars2 = newSentences\n    .map((sentence) => {\n      const line = sentence;\n      if (line in lineHash) {\n        return String.fromCharCode(lineHash[line]);\n      }\n      lineHash[line] = lineStart;\n      lineArray[lineStart] = line;\n      lineStart++;\n      return String.fromCharCode(lineHash[line]);\n    })\n    .join('');\n\n  return { chars1, chars2, lineArray };\n};\n\nexport const computeChildEqualityFactor = (node1, node2) => {\n  return 0;\n};\n\nexport const assertNodeTypeEqual = (node1, node2) => {\n  if (getNodeProperty(node1, 'type') !== getNodeProperty(node2, 'type')) {\n    throw new Error(`node type not equal: ${node1.type} !== ${node2.type}`);\n  }\n};\n\nexport const ensureArray = (value) => {\n  return Array.isArray(value) ? value : [value];\n};\n\nexport const isNodeEqual = (node1, node2) => {\n  const isNode1Array = Array.isArray(node1);\n  const isNode2Array = Array.isArray(node2);\n  if (isNode1Array !== isNode2Array) {\n    return false;\n  }\n  if (isNode1Array) {\n    return (\n      node1.length === node2.length &&\n      node1.every((node, index) => isNodeEqual(node, node2[index]))\n    );\n  }\n\n  const type1 = getNodeProperty(node1, 'type');\n  const type2 = getNodeProperty(node2, 'type');\n  if (type1 !== type2) {\n    return false;\n  }\n  if (isTextNode(node1)) {\n    const text1 = getNodeProperty(node1, 'text');\n    const text2 = getNodeProperty(node2, 'text');\n    if (text1 !== text2) {\n      return false;\n    }\n  }\n  const attrs1 = getNodeAttributes(node1);\n  const attrs2 = getNodeAttributes(node2);\n  const attrs = [...new Set([...Object.keys(attrs1), ...Object.keys(attrs2)])];\n  for (const attr of attrs) {\n    if (attrs1[attr] !== attrs2[attr]) {\n      return false;\n    }\n  }\n  const marks1 = getNodeMarks(node1);\n  const marks2 = getNodeMarks(node2);\n  if (marks1.length !== marks2.length) {\n    return false;\n  }\n  for (let i = 0; i < marks1.length; i++) {\n    if (!isNodeEqual(marks1[i], marks2[i])) {\n      return false;\n    }\n  }\n  const children1 = getNodeChildren(node1);\n  const children2 = getNodeChildren(node2);\n  if (children1.length !== children2.length) {\n    return false;\n  }\n  for (let i = 0; i < children1.length; i++) {\n    if (!isNodeEqual(children1[i], children2[i])) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexport const normalizeNodeContent = (node) => {\n  const content = getNodeChildren(node) ?? [];\n  const res = [];\n  for (let i = 0; i < content.length; i++) {\n    const child = content[i];\n    if (isTextNode(child)) {\n      const textNodes = [];\n      for (\n        let textNode = content[i];\n        i < content.length && isTextNode(textNode);\n        textNode = content[++i]\n      ) {\n        textNodes.push(textNode);\n      }\n      i--;\n      res.push(textNodes);\n    } else {\n      res.push(child);\n    }\n  }\n  return res;\n};\n\nexport const getNodeProperty = (node, property) => {\n  if (property === 'type') {\n    return node.type?.name;\n  }\n  return node[property];\n};\n\nexport const getNodeAttribute = (node, attribute) =>\n  node.attrs ? node.attrs[attribute] : undefined;\n\nexport const getNodeAttributes = (node) => (node.attrs ? node.attrs : {});\n\nexport const getNodeMarks = (node) => node.marks ?? [];\n\nexport const getNodeChildren = (node) => node.content?.content ?? [];\n\nexport const getNodeText = (node) => node.text;\n\nexport const isTextNode = (node) => node.type?.name === 'text';\n\nexport const matchNodeType = (node1, node2) =>\n  node1.type?.name === node2.type?.name ||\n  (Array.isArray(node1) && Array.isArray(node2));\n\nexport const createNewNode = (oldNode, children) => {\n  if (!oldNode.type) {\n    throw new Error('oldNode.type is undefined');\n  }\n  return new Node(\n    oldNode.type,\n    oldNode.attrs,\n    Fragment.fromArray(children),\n    oldNode.marks,\n  );\n};\n\nexport const createDiffNode = (schema, node, type) => {\n  return mapDocumentNode(node, (node) => {\n    if (isTextNode(node)) {\n      return createTextNode(schema, getNodeText(node), [\n        ...(node.marks || []),\n        createDiffMark(schema, type),\n      ]);\n    }\n    return node;\n  });\n};\n\nfunction mapDocumentNode(node, mapper) {\n  const copy = node.copy(\n    Fragment.from(\n      node.content.content\n        .map((node) => mapDocumentNode(node, mapper))\n        .filter((n) => n),\n    ),\n  );\n  return mapper(copy) || copy;\n}\n\nexport const createDiffMark = (schema, type) => {\n  if (type === DiffType.Inserted) {\n    return schema.mark('diffMark', { type });\n  }\n  if (type === DiffType.Deleted) {\n    return schema.mark('diffMark', { type });\n  }\n  throw new Error('type is not valid');\n};\n\nexport const createTextNode = (schema, content, marks = []) => {\n  return schema.text(content, marks);\n};\n\nexport const diffEditor = (schema, oldDoc, newDoc) => {\n  const oldNode = Node.fromJSON(schema, oldDoc);\n  const newNode = Node.fromJSON(schema, newDoc);\n  return patchDocumentNode(schema, oldNode, newNode);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 942, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 948, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/diffview.tsx"],"sourcesContent":["import OrderedMap from 'orderedmap';\nimport {\n  Schema,\n  type Node as ProsemirrorNode,\n  type MarkSpec,\n  DOMParser,\n} from 'prosemirror-model';\nimport { schema } from 'prosemirror-schema-basic';\nimport { addListNodes } from 'prosemirror-schema-list';\nimport { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport React, { useEffect, useRef } from 'react';\nimport { renderToString } from 'react-dom/server';\nimport ReactMarkdown from 'react-markdown';\n\nimport { diffEditor, DiffType } from '@/lib/editor/diff';\n\nconst diffSchema = new Schema({\n  nodes: addListNodes(schema.spec.nodes, 'paragraph block*', 'block'),\n  marks: OrderedMap.from({\n    ...schema.spec.marks.toObject(),\n    diffMark: {\n      attrs: { type: { default: '' } },\n      toDOM(mark) {\n        let className = '';\n\n        switch (mark.attrs.type) {\n          case DiffType.Inserted:\n            className =\n              'bg-green-100 text-green-700 dark:bg-green-500/70 dark:text-green-300';\n            break;\n          case DiffType.Deleted:\n            className =\n              'bg-red-100 line-through text-red-600 dark:bg-red-500/70 dark:text-red-300';\n            break;\n          default:\n            className = '';\n        }\n        return ['span', { class: className }, 0];\n      },\n    } as MarkSpec,\n  }),\n});\n\nfunction computeDiff(oldDoc: ProsemirrorNode, newDoc: ProsemirrorNode) {\n  return diffEditor(diffSchema, oldDoc.toJSON(), newDoc.toJSON());\n}\n\ntype DiffEditorProps = {\n  oldContent: string;\n  newContent: string;\n};\n\nexport const DiffView = ({ oldContent, newContent }: DiffEditorProps) => {\n  const editorRef = useRef<HTMLDivElement>(null);\n  const viewRef = useRef<EditorView | null>(null);\n\n  useEffect(() => {\n    if (editorRef.current && !viewRef.current) {\n      const parser = DOMParser.fromSchema(diffSchema);\n\n      const oldHtmlContent = renderToString(\n        <ReactMarkdown>{oldContent}</ReactMarkdown>,\n      );\n      const newHtmlContent = renderToString(\n        <ReactMarkdown>{newContent}</ReactMarkdown>,\n      );\n\n      const oldContainer = document.createElement('div');\n      oldContainer.innerHTML = oldHtmlContent;\n\n      const newContainer = document.createElement('div');\n      newContainer.innerHTML = newHtmlContent;\n\n      const oldDoc = parser.parse(oldContainer);\n      const newDoc = parser.parse(newContainer);\n\n      const diffedDoc = computeDiff(oldDoc, newDoc);\n\n      const state = EditorState.create({\n        doc: diffedDoc,\n        plugins: [],\n      });\n\n      viewRef.current = new EditorView(editorRef.current, {\n        state,\n        editable: () => false,\n      });\n    }\n\n    return () => {\n      if (viewRef.current) {\n        viewRef.current.destroy();\n        viewRef.current = null;\n      }\n    };\n  }, [oldContent, newContent]);\n\n  return <div className=\"diff-editor\" ref={editorRef} />;\n};\n"],"names":[],"mappings":";;;;AAWA;AACA;AAGA;AAdA;AAYA;AAJA;AACA;AAFA;AADA;AAPA;;;;;;;;;;;;;AAiBA,MAAM,aAAa,IAAI,wJAAA,CAAA,SAAM,CAAC;IAC5B,OAAO,CAAA,GAAA,iKAAA,CAAA,eAAY,AAAD,EAAE,kKAAA,CAAA,SAAM,CAAC,IAAI,CAAC,KAAK,EAAE,oBAAoB;IAC3D,OAAO,8IAAA,CAAA,UAAU,CAAC,IAAI,CAAC;QACrB,GAAG,kKAAA,CAAA,SAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;QAC/B,UAAU;YACR,OAAO;gBAAE,MAAM;oBAAE,SAAS;gBAAG;YAAE;YAC/B,OAAM,IAAI;gBACR,IAAI,YAAY;gBAEhB,OAAQ,KAAK,KAAK,CAAC,IAAI;oBACrB,KAAK,wHAAA,CAAA,WAAQ,CAAC,QAAQ;wBACpB,YACE;wBACF;oBACF,KAAK,wHAAA,CAAA,WAAQ,CAAC,OAAO;wBACnB,YACE;wBACF;oBACF;wBACE,YAAY;gBAChB;gBACA,OAAO;oBAAC;oBAAQ;wBAAE,OAAO;oBAAU;oBAAG;iBAAE;YAC1C;QACF;IACF;AACF;AAEA,SAAS,YAAY,MAAuB,EAAE,MAAuB;IACnE,OAAO,CAAA,GAAA,wHAAA,CAAA,aAAU,AAAD,EAAE,YAAY,OAAO,MAAM,IAAI,OAAO,MAAM;AAC9D;AAOO,MAAM,WAAW,CAAC,EAAE,UAAU,EAAE,UAAU,EAAmB;;IAClE,MAAM,YAAY,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAkB;IACzC,MAAM,UAAU,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAqB;IAE1C,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;8BAAE;YACR,IAAI,UAAU,OAAO,IAAI,CAAC,QAAQ,OAAO,EAAE;gBACzC,MAAM,SAAS,wJAAA,CAAA,YAAS,CAAC,UAAU,CAAC;gBAEpC,MAAM,iBAAiB,CAAA,GAAA,gMAAA,CAAA,iBAAc,AAAD,gBAClC,6MAAC,2LAAA,CAAA,UAAa;8BAAE;;;;;;gBAElB,MAAM,iBAAiB,CAAA,GAAA,gMAAA,CAAA,iBAAc,AAAD,gBAClC,6MAAC,2LAAA,CAAA,UAAa;8BAAE;;;;;;gBAGlB,MAAM,eAAe,SAAS,aAAa,CAAC;gBAC5C,aAAa,SAAS,GAAG;gBAEzB,MAAM,eAAe,SAAS,aAAa,CAAC;gBAC5C,aAAa,SAAS,GAAG;gBAEzB,MAAM,SAAS,OAAO,KAAK,CAAC;gBAC5B,MAAM,SAAS,OAAO,KAAK,CAAC;gBAE5B,MAAM,YAAY,YAAY,QAAQ;gBAEtC,MAAM,QAAQ,wJAAA,CAAA,cAAW,CAAC,MAAM,CAAC;oBAC/B,KAAK;oBACL,SAAS,EAAE;gBACb;gBAEA,QAAQ,OAAO,GAAG,IAAI,uJAAA,CAAA,aAAU,CAAC,UAAU,OAAO,EAAE;oBAClD;oBACA,QAAQ;8CAAE,IAAM;;gBAClB;YACF;YAEA;sCAAO;oBACL,IAAI,QAAQ,OAAO,EAAE;wBACnB,QAAQ,OAAO,CAAC,OAAO;wBACvB,QAAQ,OAAO,GAAG;oBACpB;gBACF;;QACF;6BAAG;QAAC;QAAY;KAAW;IAE3B,qBAAO,6MAAC;QAAI,WAAU;QAAc,KAAK;;;;;;AAC3C;GA9Ca;KAAA"}},
    {"offset": {"line": 1079, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1085, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/document-skeleton.tsx"],"sourcesContent":["'use client';\n\nexport const DocumentSkeleton = () => {\n  return (\n    <div className=\"flex flex-col gap-4 w-full\">\n      <div className=\"animate-pulse rounded-lg h-12 bg-muted-foreground/20 w-1/2\" />\n      <div className=\"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-full\" />\n      <div className=\"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-full\" />\n      <div className=\"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-1/3\" />\n      <div className=\"animate-pulse rounded-lg h-5 bg-transparent w-52\" />\n      <div className=\"animate-pulse rounded-lg h-8 bg-muted-foreground/20 w-52\" />\n      <div className=\"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-2/3\" />\n    </div>\n  );\n};\n\nexport const InlineDocumentSkeleton = () => {\n  return (\n    <div className=\"flex flex-col gap-4 w-full\">\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-48\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-3/4\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-1/2\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-64\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-40\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-36\" />\n      <div className=\"animate-pulse rounded-lg h-4 bg-muted-foreground/20 w-64\" />\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;;AAEO,MAAM,mBAAmB;IAC9B,qBACE,6MAAC;QAAI,WAAU;;0BACb,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;;;;;;;AAGrB;KAZa;AAcN,MAAM,yBAAyB;IACpC,qBACE,6MAAC;QAAI,WAAU;;0BACb,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;0BACf,6MAAC;gBAAI,WAAU;;;;;;;;;;;;AAGrB;MAZa"}},
    {"offset": {"line": 1220, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1226, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/code-block.tsx"],"sourcesContent":["'use client';\n\nimport { useCallback, useState } from 'react';\nimport { CodeIcon, LoaderIcon, PlayIcon, PythonIcon } from './icons';\nimport { Button } from './ui/button';\nimport { Tooltip, TooltipContent, TooltipTrigger } from './ui/tooltip';\nimport { cn } from '@/lib/utils';\n\ninterface CodeBlockProps {\n  node: any;\n  inline: boolean;\n  className: string;\n  children: any;\n}\n\nexport function CodeBlock({\n  node,\n  inline,\n  className,\n  children,\n  ...props\n}: CodeBlockProps) {\n  const [output, setOutput] = useState<string | null>(null);\n  const [pyodide, setPyodide] = useState<any>(null);\n  const match = /language-(\\w+)/.exec(className || '');\n  const isPython = match && match[1] === 'python';\n  const codeContent = String(children).replace(/\\n$/, '');\n  const [tab, setTab] = useState<'code' | 'run'>('code');\n\n  if (!inline) {\n    return (\n      <div className=\"not-prose flex flex-col\">\n        {tab === 'code' && (\n          <pre\n            {...props}\n            className={`text-sm w-full overflow-x-auto dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl dark:text-zinc-50 text-zinc-900`}\n          >\n            <code className=\"whitespace-pre-wrap break-words\">{children}</code>\n          </pre>\n        )}\n\n        {tab === 'run' && output && (\n          <div className=\"text-sm w-full overflow-x-auto bg-zinc-800 dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 border-t-0 rounded-b-xl text-zinc-50\">\n            <code>{output}</code>\n          </div>\n        )}\n      </div>\n    );\n  } else {\n    return (\n      <code\n        className={`${className} text-sm bg-zinc-100 dark:bg-zinc-800 py-0.5 px-1 rounded-md`}\n        {...props}\n      >\n        {children}\n      </code>\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;;;AAFA;;AAeO,SAAS,UAAU,EACxB,IAAI,EACJ,MAAM,EACN,SAAS,EACT,QAAQ,EACR,GAAG,OACY;;IACf,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAiB;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAO;IAC5C,MAAM,QAAQ,iBAAiB,IAAI,CAAC,aAAa;IACjD,MAAM,WAAW,SAAS,KAAK,CAAC,EAAE,KAAK;IACvC,MAAM,cAAc,OAAO,UAAU,OAAO,CAAC,OAAO;IACpD,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAkB;IAE/C,IAAI,CAAC,QAAQ;QACX,qBACE,6MAAC;YAAI,WAAU;;gBACZ,QAAQ,wBACP,6MAAC;oBACE,GAAG,KAAK;oBACT,WAAW,CAAC,0IAA0I,CAAC;8BAEvJ,cAAA,6MAAC;wBAAK,WAAU;kCAAmC;;;;;;;;;;;gBAItD,QAAQ,SAAS,wBAChB,6MAAC;oBAAI,WAAU;8BACb,cAAA,6MAAC;kCAAM;;;;;;;;;;;;;;;;;IAKjB,OAAO;QACL,qBACE,6MAAC;YACC,WAAW,GAAG,UAAU,4DAA4D,CAAC;YACpF,GAAG,KAAK;sBAER;;;;;;IAGP;AACF;GA3CgB;KAAA"}},
    {"offset": {"line": 1302, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1308, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/markdown.tsx"],"sourcesContent":["import Link from 'next/link';\nimport React, { memo, useMemo, useState } from 'react';\nimport ReactMarkdown, { type Components } from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { CodeBlock } from './code-block';\n\nconst components: Partial<Components> = {\n  // @ts-expect-error\n  code: CodeBlock,\n  pre: ({ children }) => <>{children}</>,\n  ol: ({ node, children, ...props }) => {\n    return (\n      <ol className=\"list-decimal list-outside ml-4\" {...props}>\n        {children}\n      </ol>\n    );\n  },\n  li: ({ node, children, ...props }) => {\n    return (\n      <li className=\"py-1\" {...props}>\n        {children}\n      </li>\n    );\n  },\n  ul: ({ node, children, ...props }) => {\n    return (\n      <ul className=\"list-decimal list-outside ml-4\" {...props}>\n        {children}\n      </ul>\n    );\n  },\n  strong: ({ node, children, ...props }) => {\n    return (\n      <span className=\"font-semibold\" {...props}>\n        {children}\n      </span>\n    );\n  },\n  a: ({ node, children, ...props }) => {\n    return (\n      // @ts-expect-error\n      <Link\n        className=\"text-blue-500 hover:underline\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        {...props}\n      >\n        {children}\n      </Link>\n    );\n  },\n  h1: ({ node, children, ...props }) => {\n    return (\n      <h1 className=\"text-3xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h1>\n    );\n  },\n  h2: ({ node, children, ...props }) => {\n    return (\n      <h2 className=\"text-2xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h2>\n    );\n  },\n  h3: ({ node, children, ...props }) => {\n    return (\n      <h3 className=\"text-xl font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h3>\n    );\n  },\n  h4: ({ node, children, ...props }) => {\n    return (\n      <h4 className=\"text-lg font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h4>\n    );\n  },\n  h5: ({ node, children, ...props }) => {\n    return (\n      <h5 className=\"text-base font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h5>\n    );\n  },\n  h6: ({ node, children, ...props }) => {\n    return (\n      <h6 className=\"text-sm font-semibold mt-6 mb-2\" {...props}>\n        {children}\n      </h6>\n    );\n  },\n};\n\nconst remarkPlugins = [remarkGfm];\n\nconst NonMemoizedMarkdown = ({ children }: { children: string }) => {\n  return (\n    <ReactMarkdown remarkPlugins={remarkPlugins} components={components}>\n      {children}\n    </ReactMarkdown>\n  );\n};\n\nexport const Markdown = memo(\n  NonMemoizedMarkdown,\n  (prevProps, nextProps) => prevProps.children === nextProps.children,\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;AAGA;AADA;AADA;;;;;;;AAIA,MAAM,aAAkC;IACtC,mBAAmB;IACnB,MAAM,+HAAA,CAAA,YAAS;IACf,KAAK,CAAC,EAAE,QAAQ,EAAE,iBAAK;sBAAG;;IAC1B,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAkC,GAAG,KAAK;sBACrD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAQ,GAAG,KAAK;sBAC3B;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAkC,GAAG,KAAK;sBACrD;;;;;;IAGP;IACA,QAAQ,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QACnC,qBACE,6MAAC;YAAK,WAAU;YAAiB,GAAG,KAAK;sBACtC;;;;;;IAGP;IACA,GAAG,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC9B,OACE,mBAAmB;sBACnB,6MAAC,+JAAA,CAAA,UAAI;YACH,WAAU;YACV,QAAO;YACP,KAAI;YACH,GAAG,KAAK;sBAER;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAoC,GAAG,KAAK;sBACvD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAoC,GAAG,KAAK;sBACvD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAmC,GAAG,KAAK;sBACtD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAmC,GAAG,KAAK;sBACtD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAqC,GAAG,KAAK;sBACxD;;;;;;IAGP;IACA,IAAI,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO;QAC/B,qBACE,6MAAC;YAAG,WAAU;YAAmC,GAAG,KAAK;sBACtD;;;;;;IAGP;AACF;AAEA,MAAM,gBAAgB;IAAC,gJAAA,CAAA,UAAS;CAAC;AAEjC,MAAM,sBAAsB,CAAC,EAAE,QAAQ,EAAwB;IAC7D,qBACE,6MAAC,2LAAA,CAAA,UAAa;QAAC,eAAe;QAAe,YAAY;kBACtD;;;;;;AAGP;KANM;AAQC,MAAM,yBAAW,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EACzB,qBACA,CAAC,WAAW,YAAc,UAAU,QAAQ,KAAK,UAAU,QAAQ"}},
    {"offset": {"line": 1477, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1483, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/suggestion.tsx"],"sourcesContent":["'use client';\n\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { useState } from 'react';\nimport { useWindowSize } from 'usehooks-ts';\n\nimport type { UISuggestion } from '@/lib/editor/suggestions';\n\nimport { CrossIcon, MessageIcon } from './icons';\nimport { Button } from './ui/button';\nimport { cn } from '@/lib/utils';\nimport { BlockKind } from './block';\n\nexport const Suggestion = ({\n  suggestion,\n  onApply,\n  blockKind,\n}: {\n  suggestion: UISuggestion;\n  onApply: () => void;\n  blockKind: BlockKind;\n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const { width: windowWidth } = useWindowSize();\n\n  return (\n    <AnimatePresence>\n      {!isExpanded ? (\n        <motion.div\n          className={cn('cursor-pointer text-muted-foreground p-1', {\n            'absolute -right-8': blockKind === 'text',\n            'sticky top-0 right-4': blockKind === 'code',\n          })}\n          onClick={() => {\n            setIsExpanded(true);\n          }}\n          whileHover={{ scale: 1.1 }}\n        >\n          <MessageIcon size={windowWidth && windowWidth < 768 ? 16 : 14} />\n        </motion.div>\n      ) : (\n        <motion.div\n          key={suggestion.id}\n          className=\"absolute bg-background p-3 flex flex-col gap-3 rounded-2xl border text-sm w-56 shadow-xl z-50 -right-12 md:-right-16 font-sans\"\n          transition={{ type: 'spring', stiffness: 500, damping: 30 }}\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: -20 }}\n          exit={{ opacity: 0, y: -10 }}\n          whileHover={{ scale: 1.05 }}\n        >\n          <div className=\"flex flex-row items-center justify-between\">\n            <div className=\"flex flex-row items-center gap-2\">\n              <div className=\"size-4 bg-muted-foreground/25 rounded-full\" />\n              <div className=\"font-medium\">Assistant</div>\n            </div>\n            <button\n              type=\"button\"\n              className=\"text-xs text-gray-500 cursor-pointer\"\n              onClick={() => {\n                setIsExpanded(false);\n              }}\n            >\n              <CrossIcon size={12} />\n            </button>\n          </div>\n          <div>{suggestion.description}</div>\n          <Button\n            variant=\"outline\"\n            className=\"w-fit py-1.5 px-3 rounded-full\"\n            onClick={onApply}\n          >\n            Apply\n          </Button>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n"],"names":[],"mappings":";;;;AAGA;AAKA;AACA;AACA;AANA;AAFA;AAAA;;;AAFA;;;;;;;AAaO,MAAM,aAAa,CAAC,EACzB,UAAU,EACV,OAAO,EACP,SAAS,EAKV;;IACC,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,CAAA,GAAA,kJAAA,CAAA,gBAAa,AAAD;IAE3C,qBACE,6MAAC,4LAAA,CAAA,kBAAe;kBACb,CAAC,2BACA,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;YACT,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EAAE,4CAA4C;gBACxD,qBAAqB,cAAc;gBACnC,wBAAwB,cAAc;YACxC;YACA,SAAS;gBACP,cAAc;YAChB;YACA,YAAY;gBAAE,OAAO;YAAI;sBAEzB,cAAA,6MAAC,uHAAA,CAAA,cAAW;gBAAC,MAAM,eAAe,cAAc,MAAM,KAAK;;;;;;;;;;iCAG7D,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;YAET,WAAU;YACV,YAAY;gBAAE,MAAM;gBAAU,WAAW;gBAAK,SAAS;YAAG;YAC1D,SAAS;gBAAE,SAAS;gBAAG,GAAG,CAAC;YAAG;YAC9B,SAAS;gBAAE,SAAS;gBAAG,GAAG,CAAC;YAAG;YAC9B,MAAM;gBAAE,SAAS;gBAAG,GAAG,CAAC;YAAG;YAC3B,YAAY;gBAAE,OAAO;YAAK;;8BAE1B,6MAAC;oBAAI,WAAU;;sCACb,6MAAC;4BAAI,WAAU;;8CACb,6MAAC;oCAAI,WAAU;;;;;;8CACf,6MAAC;oCAAI,WAAU;8CAAc;;;;;;;;;;;;sCAE/B,6MAAC;4BACC,MAAK;4BACL,WAAU;4BACV,SAAS;gCACP,cAAc;4BAChB;sCAEA,cAAA,6MAAC,uHAAA,CAAA,YAAS;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAGrB,6MAAC;8BAAK,WAAW,WAAW;;;;;;8BAC5B,6MAAC,8HAAA,CAAA,SAAM;oBACL,SAAQ;oBACR,WAAU;oBACV,SAAS;8BACV;;;;;;;WA5BI,WAAW,EAAE;;;;;;;;;;AAmC5B;GAhEa;;QAUoB,kJAAA,CAAA,gBAAa;;;KAVjC"}},
    {"offset": {"line": 1644, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1650, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/lib/editor/suggestions.tsx"],"sourcesContent":["import type { Node } from 'prosemirror-model';\nimport { Plugin, PluginKey } from 'prosemirror-state';\nimport {\n  type Decoration,\n  DecorationSet,\n  type EditorView,\n} from 'prosemirror-view';\nimport { createRoot } from 'react-dom/client';\n\nimport { Suggestion as PreviewSuggestion } from '@/components/suggestion';\nimport type { Suggestion } from '@/lib/db/schema';\nimport { BlockKind } from '@/components/block';\n\nexport interface UISuggestion extends Suggestion {\n  selectionStart: number;\n  selectionEnd: number;\n}\n\ninterface Position {\n  start: number;\n  end: number;\n}\n\nfunction findPositionsInDoc(doc: Node, searchText: string): Position | null {\n  let positions: { start: number; end: number } | null = null;\n\n  doc.nodesBetween(0, doc.content.size, (node, pos) => {\n    if (node.isText && node.text) {\n      const index = node.text.indexOf(searchText);\n\n      if (index !== -1) {\n        positions = {\n          start: pos + index,\n          end: pos + index + searchText.length,\n        };\n\n        return false;\n      }\n    }\n\n    return true;\n  });\n\n  return positions;\n}\n\nexport function projectWithPositions(\n  doc: Node,\n  suggestions: Array<Suggestion>,\n): Array<UISuggestion> {\n  return suggestions.map((suggestion) => {\n    const positions = findPositionsInDoc(doc, suggestion.originalText);\n\n    if (!positions) {\n      return {\n        ...suggestion,\n        selectionStart: 0,\n        selectionEnd: 0,\n      };\n    }\n\n    return {\n      ...suggestion,\n      selectionStart: positions.start,\n      selectionEnd: positions.end,\n    };\n  });\n}\n\nexport function createSuggestionWidget(\n  suggestion: UISuggestion,\n  view: EditorView,\n  blockKind: BlockKind = 'text',\n): { dom: HTMLElement; destroy: () => void } {\n  const dom = document.createElement('span');\n  const root = createRoot(dom);\n\n  dom.addEventListener('mousedown', (event) => {\n    event.preventDefault();\n    view.dom.blur();\n  });\n\n  const onApply = () => {\n    const { state, dispatch } = view;\n\n    const decorationTransaction = state.tr;\n    const currentState = suggestionsPluginKey.getState(state);\n    const currentDecorations = currentState?.decorations;\n\n    if (currentDecorations) {\n      const newDecorations = DecorationSet.create(\n        state.doc,\n        currentDecorations.find().filter((decoration: Decoration) => {\n          return decoration.spec.suggestionId !== suggestion.id;\n        }),\n      );\n\n      decorationTransaction.setMeta(suggestionsPluginKey, {\n        decorations: newDecorations,\n        selected: null,\n      });\n      dispatch(decorationTransaction);\n    }\n\n    const textTransaction = view.state.tr.replaceWith(\n      suggestion.selectionStart,\n      suggestion.selectionEnd,\n      state.schema.text(suggestion.suggestedText),\n    );\n\n    textTransaction.setMeta('no-debounce', true);\n\n    dispatch(textTransaction);\n  };\n\n  root.render(\n    <PreviewSuggestion\n      suggestion={suggestion}\n      onApply={onApply}\n      blockKind={blockKind}\n    />,\n  );\n\n  return {\n    dom,\n    destroy: () => {\n      // Wrapping unmount in setTimeout to avoid synchronous unmounting during render\n      setTimeout(() => {\n        root.unmount();\n      }, 0);\n    },\n  };\n}\n\nexport const suggestionsPluginKey = new PluginKey('suggestions');\nexport const suggestionsPlugin = new Plugin({\n  key: suggestionsPluginKey,\n  state: {\n    init() {\n      return { decorations: DecorationSet.empty, selected: null };\n    },\n    apply(tr, state) {\n      const newDecorations = tr.getMeta(suggestionsPluginKey);\n      if (newDecorations) return newDecorations;\n\n      return {\n        decorations: state.decorations.map(tr.mapping, tr.doc),\n        selected: state.selected,\n      };\n    },\n  },\n  props: {\n    decorations(state) {\n      return this.getState(state)?.decorations ?? DecorationSet.empty;\n    },\n  },\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1773, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1779, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/lib/editor/functions.tsx"],"sourcesContent":["'use client';\n\nimport { defaultMarkdownSerializer } from 'prosemirror-markdown';\nimport { DOMParser, type Node } from 'prosemirror-model';\nimport { Decoration, DecorationSet, type EditorView } from 'prosemirror-view';\nimport { renderToString } from 'react-dom/server';\n\nimport { Markdown } from '@/components/markdown';\n\nimport { documentSchema } from './config';\nimport { createSuggestionWidget, type UISuggestion } from './suggestions';\n\nexport const buildDocumentFromContent = (content: string) => {\n  const parser = DOMParser.fromSchema(documentSchema);\n  const stringFromMarkdown = renderToString(<Markdown>{content}</Markdown>);\n  const tempContainer = document.createElement('div');\n  tempContainer.innerHTML = stringFromMarkdown;\n  return parser.parse(tempContainer);\n};\n\nexport const buildContentFromDocument = (document: Node) => {\n  return defaultMarkdownSerializer.serialize(document);\n};\n\nexport const createDecorations = (\n  suggestions: Array<UISuggestion>,\n  view: EditorView,\n) => {\n  const decorations: Array<Decoration> = [];\n\n  for (const suggestion of suggestions) {\n    decorations.push(\n      Decoration.inline(\n        suggestion.selectionStart,\n        suggestion.selectionEnd,\n        {\n          class: 'suggestion-highlight',\n        },\n        {\n          suggestionId: suggestion.id,\n          type: 'highlight',\n        },\n      ),\n    );\n\n    decorations.push(\n      Decoration.widget(\n        suggestion.selectionStart,\n        (view) => {\n          const { dom } = createSuggestionWidget(suggestion, view);\n          return dom;\n        },\n        {\n          suggestionId: suggestion.id,\n          type: 'widget',\n        },\n      ),\n    );\n  }\n\n  return DecorationSet.create(view.state.doc, decorations);\n};\n"],"names":[],"mappings":";;;;;;AAKA;AAEA;AAEA;AACA;AAPA;AADA;AAEA;AAJA;;;;;;;;;AAYO,MAAM,2BAA2B,CAAC;IACvC,MAAM,SAAS,wJAAA,CAAA,YAAS,CAAC,UAAU,CAAC,0HAAA,CAAA,iBAAc;IAClD,MAAM,qBAAqB,CAAA,GAAA,gMAAA,CAAA,iBAAc,AAAD,gBAAE,6MAAC,0HAAA,CAAA,WAAQ;kBAAE;;;;;;IACrD,MAAM,gBAAgB,SAAS,aAAa,CAAC;IAC7C,cAAc,SAAS,GAAG;IAC1B,OAAO,OAAO,KAAK,CAAC;AACtB;AAEO,MAAM,2BAA2B,CAAC;IACvC,OAAO,2JAAA,CAAA,4BAAyB,CAAC,SAAS,CAAC;AAC7C;AAEO,MAAM,oBAAoB,CAC/B,aACA;IAEA,MAAM,cAAiC,EAAE;IAEzC,KAAK,MAAM,cAAc,YAAa;QACpC,YAAY,IAAI,CACd,uJAAA,CAAA,aAAU,CAAC,MAAM,CACf,WAAW,cAAc,EACzB,WAAW,YAAY,EACvB;YACE,OAAO;QACT,GACA;YACE,cAAc,WAAW,EAAE;YAC3B,MAAM;QACR;QAIJ,YAAY,IAAI,CACd,uJAAA,CAAA,aAAU,CAAC,MAAM,CACf,WAAW,cAAc,EACzB,CAAC;YACC,MAAM,EAAE,GAAG,EAAE,GAAG,CAAA,GAAA,gIAAA,CAAA,yBAAsB,AAAD,EAAE,YAAY;YACnD,OAAO;QACT,GACA;YACE,cAAc,WAAW,EAAE;YAC3B,MAAM;QACR;IAGN;IAEA,OAAO,uJAAA,CAAA,gBAAa,CAAC,MAAM,CAAC,KAAK,KAAK,CAAC,GAAG,EAAE;AAC9C"}},
    {"offset": {"line": 1839, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1845, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/lib/editor/config.ts"],"sourcesContent":["import { textblockTypeInputRule } from 'prosemirror-inputrules';\nimport { Schema } from 'prosemirror-model';\nimport { schema } from 'prosemirror-schema-basic';\nimport { addListNodes } from 'prosemirror-schema-list';\nimport type { Transaction } from 'prosemirror-state';\nimport type { EditorView } from 'prosemirror-view';\nimport type { MutableRefObject } from 'react';\n\nimport { buildContentFromDocument } from './functions';\n\nexport const documentSchema = new Schema({\n  nodes: addListNodes(schema.spec.nodes, 'paragraph block*', 'block'),\n  marks: schema.spec.marks,\n});\n\nexport function headingRule(level: number) {\n  return textblockTypeInputRule(\n    new RegExp(`^(#{1,${level}})\\\\s$`),\n    documentSchema.nodes.heading,\n    () => ({ level }),\n  );\n}\n\nexport const handleTransaction = ({\n  transaction,\n  editorRef,\n  saveContent,\n}: {\n  transaction: Transaction;\n  editorRef: MutableRefObject<EditorView | null>;\n  saveContent: (updatedContent: string, debounce: boolean) => void;\n}) => {\n  if (!editorRef || !editorRef.current) return;\n\n  const newState = editorRef.current.state.apply(transaction);\n  editorRef.current.updateState(newState);\n\n  if (transaction.docChanged && !transaction.getMeta('no-save')) {\n    const updatedContent = buildContentFromDocument(newState.doc);\n\n    if (transaction.getMeta('no-debounce')) {\n      saveContent(updatedContent, false);\n    } else {\n      saveContent(updatedContent, true);\n    }\n  }\n};\n"],"names":[],"mappings":";;;;;AAQA;AAPA;AAEA;AADA;AAFA;;;;;;AAUO,MAAM,iBAAiB,IAAI,wJAAA,CAAA,SAAM,CAAC;IACvC,OAAO,CAAA,GAAA,iKAAA,CAAA,eAAY,AAAD,EAAE,kKAAA,CAAA,SAAM,CAAC,IAAI,CAAC,KAAK,EAAE,oBAAoB;IAC3D,OAAO,kKAAA,CAAA,SAAM,CAAC,IAAI,CAAC,KAAK;AAC1B;AAEO,SAAS,YAAY,KAAa;IACvC,OAAO,CAAA,GAAA,6JAAA,CAAA,yBAAsB,AAAD,EAC1B,IAAI,OAAO,CAAC,MAAM,EAAE,MAAM,MAAM,CAAC,GACjC,eAAe,KAAK,CAAC,OAAO,EAC5B,IAAM,CAAC;YAAE;QAAM,CAAC;AAEpB;AAEO,MAAM,oBAAoB,CAAC,EAChC,WAAW,EACX,SAAS,EACT,WAAW,EAKZ;IACC,IAAI,CAAC,aAAa,CAAC,UAAU,OAAO,EAAE;IAEtC,MAAM,WAAW,UAAU,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;IAC/C,UAAU,OAAO,CAAC,WAAW,CAAC;IAE9B,IAAI,YAAY,UAAU,IAAI,CAAC,YAAY,OAAO,CAAC,YAAY;QAC7D,MAAM,iBAAiB,CAAA,GAAA,8HAAA,CAAA,2BAAwB,AAAD,EAAE,SAAS,GAAG;QAE5D,IAAI,YAAY,OAAO,CAAC,gBAAgB;YACtC,YAAY,gBAAgB;QAC9B,OAAO;YACL,YAAY,gBAAgB;QAC9B;IACF;AACF"}},
    {"offset": {"line": 1885, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1891, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/editor.tsx"],"sourcesContent":["'use client';\n\nimport { exampleSetup } from 'prosemirror-example-setup';\nimport { inputRules } from 'prosemirror-inputrules';\nimport { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport React, { memo, useEffect, useRef } from 'react';\n\nimport type { Suggestion } from '@/lib/db/schema';\nimport {\n  documentSchema,\n  handleTransaction,\n  headingRule,\n} from '@/lib/editor/config';\nimport {\n  buildContentFromDocument,\n  buildDocumentFromContent,\n  createDecorations,\n} from '@/lib/editor/functions';\nimport {\n  projectWithPositions,\n  suggestionsPlugin,\n  suggestionsPluginKey,\n} from '@/lib/editor/suggestions';\n\ntype EditorProps = {\n  content: string;\n  saveContent: (updatedContent: string, debounce: boolean) => void;\n  status: 'streaming' | 'idle';\n  isCurrentVersion: boolean;\n  currentVersionIndex: number;\n  suggestions: Array<Suggestion>;\n};\n\nfunction PureEditor({\n  content,\n  saveContent,\n  suggestions,\n  status,\n}: EditorProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const editorRef = useRef<EditorView | null>(null);\n\n  useEffect(() => {\n    if (containerRef.current && !editorRef.current) {\n      const state = EditorState.create({\n        doc: buildDocumentFromContent(content),\n        plugins: [\n          ...exampleSetup({ schema: documentSchema, menuBar: false }),\n          inputRules({\n            rules: [\n              headingRule(1),\n              headingRule(2),\n              headingRule(3),\n              headingRule(4),\n              headingRule(5),\n              headingRule(6),\n            ],\n          }),\n          suggestionsPlugin,\n        ],\n      });\n\n      editorRef.current = new EditorView(containerRef.current, {\n        state,\n      });\n    }\n\n    return () => {\n      if (editorRef.current) {\n        editorRef.current.destroy();\n        editorRef.current = null;\n      }\n    };\n    // NOTE: we only want to run this effect once\n    // eslint-disable-next-line\n  }, []);\n\n  useEffect(() => {\n    if (editorRef.current) {\n      editorRef.current.setProps({\n        dispatchTransaction: (transaction) => {\n          handleTransaction({ transaction, editorRef, saveContent });\n        },\n      });\n    }\n  }, [saveContent]);\n\n  useEffect(() => {\n    if (editorRef.current && content) {\n      const currentContent = buildContentFromDocument(\n        editorRef.current.state.doc,\n      );\n\n      if (status === 'streaming') {\n        const newDocument = buildDocumentFromContent(content);\n\n        const transaction = editorRef.current.state.tr.replaceWith(\n          0,\n          editorRef.current.state.doc.content.size,\n          newDocument.content,\n        );\n\n        transaction.setMeta('no-save', true);\n        editorRef.current.dispatch(transaction);\n        return;\n      }\n\n      if (currentContent !== content) {\n        const newDocument = buildDocumentFromContent(content);\n\n        const transaction = editorRef.current.state.tr.replaceWith(\n          0,\n          editorRef.current.state.doc.content.size,\n          newDocument.content,\n        );\n\n        transaction.setMeta('no-save', true);\n        editorRef.current.dispatch(transaction);\n      }\n    }\n  }, [content, status]);\n\n  useEffect(() => {\n    if (editorRef.current?.state.doc && content) {\n      const projectedSuggestions = projectWithPositions(\n        editorRef.current.state.doc,\n        suggestions,\n      ).filter(\n        (suggestion) => suggestion.selectionStart && suggestion.selectionEnd,\n      );\n\n      const decorations = createDecorations(\n        projectedSuggestions,\n        editorRef.current,\n      );\n\n      const transaction = editorRef.current.state.tr;\n      transaction.setMeta(suggestionsPluginKey, { decorations });\n      editorRef.current.dispatch(transaction);\n    }\n  }, [suggestions, content]);\n\n  return (\n    <div className=\"relative prose dark:prose-invert\" ref={containerRef} />\n  );\n}\n\nfunction areEqual(prevProps: EditorProps, nextProps: EditorProps) {\n  return (\n    prevProps.suggestions === nextProps.suggestions &&\n    prevProps.currentVersionIndex === nextProps.currentVersionIndex &&\n    prevProps.isCurrentVersion === nextProps.isCurrentVersion &&\n    !(prevProps.status === 'streaming' && nextProps.status === 'streaming') &&\n    prevProps.content === nextProps.content &&\n    prevProps.saveContent === nextProps.saveContent\n  );\n}\n\nexport const Editor = memo(PureEditor, areEqual);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2039, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2045, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/preview-attachment.tsx"],"sourcesContent":["import type { Attachment } from 'ai';\n\nimport { LoaderIcon } from './icons';\n\nexport const PreviewAttachment = ({\n  attachment,\n  isUploading = false,\n}: {\n  attachment: Attachment;\n  isUploading?: boolean;\n}) => {\n  const { name, url, contentType } = attachment;\n\n  return (\n    <div className=\"flex flex-col gap-2\">\n      <div className=\"w-20 h-16 aspect-video bg-muted rounded-md relative flex flex-col items-center justify-center\">\n        {contentType ? (\n          contentType.startsWith('image') ? (\n            // NOTE: it is recommended to use next/image for images\n            // eslint-disable-next-line @next/next/no-img-element\n            <img\n              key={url}\n              src={url}\n              alt={name ?? 'An image attachment'}\n              className=\"rounded-md size-full object-cover\"\n            />\n          ) : (\n            <div className=\"\" />\n          )\n        ) : (\n          <div className=\"\" />\n        )}\n\n        {isUploading && (\n          <div className=\"animate-spin absolute text-zinc-500\">\n            <LoaderIcon />\n          </div>\n        )}\n      </div>\n      <div className=\"text-xs text-zinc-500 max-w-16 truncate\">{name}</div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;AAEA;;;AAEO,MAAM,oBAAoB,CAAC,EAChC,UAAU,EACV,cAAc,KAAK,EAIpB;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,WAAW,EAAE,GAAG;IAEnC,qBACE,6MAAC;QAAI,WAAU;;0BACb,6MAAC;gBAAI,WAAU;;oBACZ,cACC,YAAY,UAAU,CAAC,WACrB,uDAAuD;oBACvD,qDAAqD;kCACrD,6MAAC;wBAEC,KAAK;wBACL,KAAK,QAAQ;wBACb,WAAU;uBAHL;;;;6CAMP,6MAAC;wBAAI,WAAU;;;;;6CAGjB,6MAAC;wBAAI,WAAU;;;;;;oBAGhB,6BACC,6MAAC;wBAAI,WAAU;kCACb,cAAA,6MAAC,uHAAA,CAAA,aAAU;;;;;;;;;;;;;;;;0BAIjB,6MAAC;gBAAI,WAAU;0BAA2C;;;;;;;;;;;;AAGhE;KAtCa"}},
    {"offset": {"line": 2122, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2128, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/ui/textarea.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { cn } from '@/lib/utils';\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<'textarea'>\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        className,\n      )}\n      ref={ref}\n      {...props}\n    />\n  );\n});\nTextarea.displayName = 'Textarea';\n\nexport { Textarea };\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEA,MAAM,yBAAW,8KAAM,UAAU,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,6MAAC;QACC,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,qTACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AACA,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 2157, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2163, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/suggested-actions.tsx"],"sourcesContent":["'use client';\n\nimport { motion } from 'framer-motion';\nimport { Button } from './ui/button';\nimport { ChatRequestOptions, CreateMessage, Message } from 'ai';\nimport { memo } from 'react';\n\ninterface SuggestedActionsProps {\n  chatId: string;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n}\n\nfunction PureSuggestedActions({ chatId, append }: SuggestedActionsProps) {\n  const suggestedActions = [\n    {\n      title: 'Most profitable location to sell',\n      label: '200 SCU of Gold in Stanton',\n      action: 'Most profitable location to sell 200 SCU of Gold in Stanton',\n    },\n    {\n      title: 'Plan a trade route',\n      label: `for Gold within the Stanton system`,\n      action: `Plan a trade route for Gold within the Stanton system. I have 100 SCU of storage and looking for the most profitable route`,\n    },\n    {\n      title: 'How can I donate?',\n      label: `Show Donation Info for DanielVNZ`,\n      action: `Show Donation Info for DanielVNZ`,\n    },\n    {\n      title: 'How can I donate?',\n      label: 'Show Donation Info for UEX CORP',\n      action: 'Show Donation information for UEX Corp',\n    },\n  ];\n\n  return (\n    <div className=\"grid sm:grid-cols-2 gap-2 w-full\">\n      {suggestedActions.map((suggestedAction, index) => (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: 20 }}\n          transition={{ delay: 0.05 * index }}\n          key={`suggested-action-${suggestedAction.title}-${index}`}\n          className={index > 1 ? 'hidden sm:block' : 'block'}\n        >\n          <Button\n            variant=\"ghost\"\n            onClick={async () => {\n              window.history.replaceState({}, '', `/chat/${chatId}`);\n\n              append({\n                role: 'user',\n                content: suggestedAction.action,\n              });\n            }}\n            className=\"text-left border rounded-xl px-4 py-3.5 text-sm flex-1 gap-1 sm:flex-col w-full h-auto justify-start items-start\"\n          >\n            <span className=\"font-medium\">{suggestedAction.title}</span>\n            <span className=\"text-muted-foreground\">\n              {suggestedAction.label}\n            </span>\n          </Button>\n        </motion.div>\n      ))}\n    </div>\n  );\n}\n\nexport const SuggestedActions = memo(PureSuggestedActions, () => true);\n"],"names":[],"mappings":";;;;AAGA;AAEA;AAHA;AAFA;;;;;AAeA,SAAS,qBAAqB,EAAE,MAAM,EAAE,MAAM,EAAyB;IACrE,MAAM,mBAAmB;QACvB;YACE,OAAO;YACP,OAAO;YACP,QAAQ;QACV;QACA;YACE,OAAO;YACP,OAAO,CAAC,kCAAkC,CAAC;YAC3C,QAAQ,CAAC,0HAA0H,CAAC;QACtI;QACA;YACE,OAAO;YACP,OAAO,CAAC,gCAAgC,CAAC;YACzC,QAAQ,CAAC,gCAAgC,CAAC;QAC5C;QACA;YACE,OAAO;YACP,OAAO;YACP,QAAQ;QACV;KACD;IAED,qBACE,6MAAC;QAAI,WAAU;kBACZ,iBAAiB,GAAG,CAAC,CAAC,iBAAiB,sBACtC,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,MAAM;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC1B,YAAY;oBAAE,OAAO,OAAO;gBAAM;gBAElC,WAAW,QAAQ,IAAI,oBAAoB;0BAE3C,cAAA,6MAAC,8HAAA,CAAA,SAAM;oBACL,SAAQ;oBACR,SAAS;wBACP,OAAO,OAAO,CAAC,YAAY,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,QAAQ;wBAErD,OAAO;4BACL,MAAM;4BACN,SAAS,gBAAgB,MAAM;wBACjC;oBACF;oBACA,WAAU;;sCAEV,6MAAC;4BAAK,WAAU;sCAAe,gBAAgB,KAAK;;;;;;sCACpD,6MAAC;4BAAK,WAAU;sCACb,gBAAgB,KAAK;;;;;;;;;;;;eAjBrB,CAAC,iBAAiB,EAAE,gBAAgB,KAAK,CAAC,CAAC,EAAE,OAAO;;;;;;;;;;AAwBnE;KAxDS;AA0DF,MAAM,iCAAmB,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAAE,sBAAsB,IAAM"}},
    {"offset": {"line": 2270, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2276, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/multimodal-input.tsx"],"sourcesContent":["'use client';\n\nimport type {\n  Attachment,\n  ChatRequestOptions,\n  CreateMessage,\n  Message,\n} from 'ai';\nimport cx from 'classnames';\nimport type React from 'react';\nimport {\n  useRef,\n  useEffect,\n  useState,\n  useCallback,\n  type Dispatch,\n  type SetStateAction,\n  type ChangeEvent,\n  memo,\n} from 'react';\nimport { toast } from 'sonner';\nimport { useLocalStorage, useWindowSize } from 'usehooks-ts';\n\nimport { sanitizeUIMessages } from '@/lib/utils';\n\nimport { ArrowUpIcon, PaperclipIcon, StopIcon } from './icons';\nimport { PreviewAttachment } from './preview-attachment';\nimport { Button } from './ui/button';\nimport { Textarea } from './ui/textarea';\nimport { SuggestedActions } from './suggested-actions';\nimport equal from 'fast-deep-equal';\n\nfunction PureMultimodalInput({\n  chatId,\n  input,\n  setInput,\n  isLoading,\n  stop,\n  attachments,\n  setAttachments,\n  messages,\n  setMessages,\n  append,\n  handleSubmit,\n  className,\n}: {\n  chatId: string;\n  input: string;\n  setInput: (value: string) => void;\n  isLoading: boolean;\n  stop: () => void;\n  attachments: Array<Attachment>;\n  setAttachments: Dispatch<SetStateAction<Array<Attachment>>>;\n  messages: Array<Message>;\n  setMessages: Dispatch<SetStateAction<Array<Message>>>;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  handleSubmit: (\n    event?: {\n      preventDefault?: () => void;\n    },\n    chatRequestOptions?: ChatRequestOptions,\n  ) => void;\n  className?: string;\n}) {\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const { width } = useWindowSize();\n\n  useEffect(() => {\n    if (textareaRef.current) {\n      adjustHeight();\n    }\n  }, []);\n\n  const adjustHeight = () => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto';\n      textareaRef.current.style.height = `${textareaRef.current.scrollHeight + 2}px`;\n    }\n  };\n\n  const [localStorageInput, setLocalStorageInput] = useLocalStorage(\n    'input',\n    '',\n  );\n\n  useEffect(() => {\n    if (textareaRef.current) {\n      const domValue = textareaRef.current.value;\n      // Prefer DOM value over localStorage to handle hydration\n      const finalValue = domValue || localStorageInput || '';\n      setInput(finalValue);\n      adjustHeight();\n    }\n    // Only run once after hydration\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    setLocalStorageInput(input);\n  }, [input, setLocalStorageInput]);\n\n  const handleInput = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setInput(event.target.value);\n    adjustHeight();\n  };\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploadQueue, setUploadQueue] = useState<Array<string>>([]);\n\n  const submitForm = useCallback(() => {\n    window.history.replaceState({}, '', `/chat/${chatId}`);\n\n    handleSubmit(undefined, {\n      experimental_attachments: attachments,\n    });\n\n    setAttachments([]);\n    setLocalStorageInput('');\n\n    if (width && width > 768) {\n      textareaRef.current?.focus();\n    }\n  }, [\n    attachments,\n    handleSubmit,\n    setAttachments,\n    setLocalStorageInput,\n    width,\n    chatId,\n  ]);\n\n  const uploadFile = async (file: File) => {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const response = await fetch('/api/files/upload', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        const { url, pathname, contentType } = data;\n\n        return {\n          url,\n          name: pathname,\n          contentType: contentType,\n        };\n      }\n      const { error } = await response.json();\n      toast.error(error);\n    } catch (error) {\n      toast.error('Failed to upload file, please try again!');\n    }\n  };\n\n  const handleFileChange = useCallback(\n    async (event: ChangeEvent<HTMLInputElement>) => {\n      const files = Array.from(event.target.files || []);\n\n      setUploadQueue(files.map((file) => file.name));\n\n      try {\n        const uploadPromises = files.map((file) => uploadFile(file));\n        const uploadedAttachments = await Promise.all(uploadPromises);\n        const successfullyUploadedAttachments = uploadedAttachments.filter(\n          (attachment) => attachment !== undefined,\n        );\n\n        setAttachments((currentAttachments) => [\n          ...currentAttachments,\n          ...successfullyUploadedAttachments,\n        ]);\n      } catch (error) {\n        console.error('Error uploading files!', error);\n      } finally {\n        setUploadQueue([]);\n      }\n    },\n    [setAttachments],\n  );\n\n  return (\n    <div className=\"relative w-full flex flex-col gap-4\">\n      {messages.length === 0 &&\n        attachments.length === 0 &&\n        uploadQueue.length === 0 && (\n          <SuggestedActions append={append} chatId={chatId} />\n        )}\n\n      <input\n        type=\"file\"\n        className=\"fixed -top-4 -left-4 size-0.5 opacity-0 pointer-events-none\"\n        ref={fileInputRef}\n        multiple\n        onChange={handleFileChange}\n        tabIndex={-1}\n      />\n\n      {(attachments.length > 0 || uploadQueue.length > 0) && (\n        <div className=\"flex flex-row gap-2 overflow-x-scroll items-end\">\n          {attachments.map((attachment) => (\n            <PreviewAttachment key={attachment.url} attachment={attachment} />\n          ))}\n\n          {uploadQueue.map((filename) => (\n            <PreviewAttachment\n              key={filename}\n              attachment={{\n                url: '',\n                name: filename,\n                contentType: '',\n              }}\n              isUploading={true}\n            />\n          ))}\n        </div>\n      )}\n\n      <Textarea\n        ref={textareaRef}\n        placeholder=\"Send a message to Star Trader...\"\n        value={input}\n        onChange={handleInput}\n        className={cx(\n          'min-h-[24px] max-h-[calc(75dvh)] overflow-hidden resize-none rounded-2xl !text-base bg-muted pb-10 dark:border-zinc-700',\n          className,\n        )}\n        rows={2}\n        autoFocus\n        onKeyDown={(event) => {\n          if (event.key === 'Enter' && !event.shiftKey) {\n            event.preventDefault();\n\n            if (isLoading) {\n              toast.error('Please wait for Star Trader to finish its response!');\n            } else {\n              submitForm();\n            }\n          }\n        }}\n      />\n\n      \n\n      <div className=\"absolute bottom-0 right-0 p-2 w-fit flex flex-row justify-end\">\n        {isLoading ? (\n          <StopButton stop={stop} setMessages={setMessages} />\n        ) : (\n          <SendButton\n            input={input}\n            submitForm={submitForm}\n            uploadQueue={uploadQueue}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport const MultimodalInput = memo(\n  PureMultimodalInput,\n  (prevProps, nextProps) => {\n    if (prevProps.input !== nextProps.input) return false;\n    if (prevProps.isLoading !== nextProps.isLoading) return false;\n    if (!equal(prevProps.attachments, nextProps.attachments)) return false;\n\n    return true;\n  },\n);\n\nfunction PureAttachmentsButton({\n  fileInputRef,\n  isLoading,\n}: {\n  fileInputRef: React.MutableRefObject<HTMLInputElement | null>;\n  isLoading: boolean;\n}) {\n  return (\n    <Button\n      className=\"rounded-md rounded-bl-lg p-[7px] h-fit dark:border-zinc-700 hover:dark:bg-zinc-900 hover:bg-zinc-200\"\n      onClick={(event) => {\n        event.preventDefault();\n        fileInputRef.current?.click();\n      }}\n      disabled={isLoading}\n      variant=\"ghost\"\n    >\n      <PaperclipIcon size={14} />\n    </Button>\n  );\n}\n\nconst AttachmentsButton = memo(PureAttachmentsButton);\n\nfunction PureStopButton({\n  stop,\n  setMessages,\n}: {\n  stop: () => void;\n  setMessages: Dispatch<SetStateAction<Array<Message>>>;\n}) {\n  return (\n    <Button\n      className=\"rounded-full p-1.5 h-fit border dark:border-zinc-600\"\n      onClick={(event) => {\n        event.preventDefault();\n        stop();\n        setMessages((messages) => sanitizeUIMessages(messages));\n      }}\n    >\n      <StopIcon size={14} />\n    </Button>\n  );\n}\n\nconst StopButton = memo(PureStopButton);\n\nfunction PureSendButton({\n  submitForm,\n  input,\n  uploadQueue,\n}: {\n  submitForm: () => void;\n  input: string;\n  uploadQueue: Array<string>;\n}) {\n  return (\n    <Button\n      className=\"rounded-full p-1.5 h-fit border dark:border-zinc-600\"\n      onClick={(event) => {\n        event.preventDefault();\n        submitForm();\n      }}\n      disabled={input.length === 0 || uploadQueue.length > 0}\n    >\n      <ArrowUpIcon size={14} />\n    </Button>\n  );\n}\n\nconst SendButton = memo(PureSendButton, (prevProps, nextProps) => {\n  if (prevProps.uploadQueue.length !== nextProps.uploadQueue.length)\n    return false;\n  if (prevProps.input !== nextProps.input) return false;\n  return true;\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2629, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2635, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/toolbar.tsx"],"sourcesContent":["'use client';\n\nimport type { ChatRequestOptions, CreateMessage, Message } from 'ai';\nimport cx from 'classnames';\nimport {\n  AnimatePresence,\n  motion,\n  useMotionValue,\n  useTransform,\n} from 'framer-motion';\nimport {\n  type Dispatch,\n  memo,\n  type SetStateAction,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { useOnClickOutside } from 'usehooks-ts';\nimport { nanoid } from 'nanoid';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { sanitizeUIMessages } from '@/lib/utils';\n\nimport {\n  ArrowUpIcon,\n  CodeIcon,\n  FileIcon,\n  LogsIcon,\n  MessageIcon,\n  PenIcon,\n  StopIcon,\n  SummarizeIcon,\n  TerminalIcon,\n} from './icons';\nimport { BlockKind } from './block';\n\ntype ToolProps = {\n  type:\n    | 'final-polish'\n    | 'request-suggestions'\n    | 'adjust-reading-level'\n    | 'code-review'\n    | 'add-comments'\n    | 'add-logs';\n  description: string;\n  icon: JSX.Element;\n  selectedTool: string | null;\n  setSelectedTool: Dispatch<SetStateAction<string | null>>;\n  isToolbarVisible?: boolean;\n  setIsToolbarVisible?: Dispatch<SetStateAction<boolean>>;\n  isAnimating: boolean;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n};\n\nconst Tool = ({\n  type,\n  description,\n  icon,\n  selectedTool,\n  setSelectedTool,\n  isToolbarVisible,\n  setIsToolbarVisible,\n  isAnimating,\n  append,\n}: ToolProps) => {\n  const [isHovered, setIsHovered] = useState(false);\n\n  useEffect(() => {\n    if (selectedTool !== type) {\n      setIsHovered(false);\n    }\n  }, [selectedTool, type]);\n\n  const handleSelect = () => {\n    if (!isToolbarVisible && setIsToolbarVisible) {\n      setIsToolbarVisible(true);\n      return;\n    }\n\n    if (!selectedTool) {\n      setIsHovered(true);\n      setSelectedTool(type);\n      return;\n    }\n\n    if (selectedTool !== type) {\n      setSelectedTool(type);\n    } else {\n      if (type === 'final-polish') {\n        append({\n          role: 'user',\n          content:\n            'Please add final polish and check for grammar, add section titles for better structure, and ensure everything reads smoothly.',\n        });\n\n        setSelectedTool(null);\n      } else if (type === 'request-suggestions') {\n        append({\n          role: 'user',\n          content:\n            'Please add suggestions you have that could improve the writing.',\n        });\n\n        setSelectedTool(null);\n      } else if (type === 'add-comments') {\n        append({\n          role: 'user',\n          content: 'Please add comments to explain the code.',\n        });\n\n        setSelectedTool(null);\n      } else if (type === 'add-logs') {\n        append({\n          role: 'user',\n          content: 'Please add logs to help debug the code.',\n        });\n\n        setSelectedTool(null);\n      }\n    }\n  };\n\n  return (\n    <Tooltip open={isHovered && !isAnimating}>\n      <TooltipTrigger asChild>\n        <motion.div\n          className={cx('p-3 rounded-full', {\n            'bg-primary !text-primary-foreground': selectedTool === type,\n          })}\n          onHoverStart={() => {\n            setIsHovered(true);\n          }}\n          onHoverEnd={() => {\n            if (selectedTool !== type) setIsHovered(false);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              handleSelect();\n            }\n          }}\n          initial={{ scale: 1, opacity: 0 }}\n          animate={{ opacity: 1, transition: { delay: 0.1 } }}\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.95 }}\n          exit={{\n            scale: 0.9,\n            opacity: 0,\n            transition: { duration: 0.1 },\n          }}\n          onClick={() => {\n            handleSelect();\n          }}\n        >\n          {selectedTool === type ? <ArrowUpIcon /> : icon}\n        </motion.div>\n      </TooltipTrigger>\n      <TooltipContent\n        side=\"left\"\n        sideOffset={16}\n        className=\"bg-foreground text-background rounded-2xl p-3 px-4\"\n      >\n        {description}\n      </TooltipContent>\n    </Tooltip>\n  );\n};\n\nconst randomArr = [...Array(6)].map((x) => nanoid(5));\n\nconst ReadingLevelSelector = ({\n  setSelectedTool,\n  append,\n  isAnimating,\n}: {\n  setSelectedTool: Dispatch<SetStateAction<string | null>>;\n  isAnimating: boolean;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n}) => {\n  const LEVELS = [\n    'Elementary',\n    'Middle School',\n    'Keep current level',\n    'High School',\n    'College',\n    'Graduate',\n  ];\n\n  const y = useMotionValue(-40 * 2);\n  const dragConstraints = 5 * 40 + 2;\n  const yToLevel = useTransform(y, [0, -dragConstraints], [0, 5]);\n\n  const [currentLevel, setCurrentLevel] = useState(2);\n  const [hasUserSelectedLevel, setHasUserSelectedLevel] =\n    useState<boolean>(false);\n\n  useEffect(() => {\n    const unsubscribe = yToLevel.on('change', (latest) => {\n      const level = Math.min(5, Math.max(0, Math.round(Math.abs(latest))));\n      setCurrentLevel(level);\n    });\n\n    return () => unsubscribe();\n  }, [yToLevel]);\n\n  return (\n    <div className=\"relative flex flex-col justify-end items-center\">\n      {randomArr.map((id) => (\n        <motion.div\n          key={id}\n          className=\"size-[40px] flex flex-row items-center justify-center\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ delay: 0.1 }}\n        >\n          <div className=\"size-2 rounded-full bg-muted-foreground/40\" />\n        </motion.div>\n      ))}\n\n      <TooltipProvider>\n        <Tooltip open={!isAnimating}>\n          <TooltipTrigger asChild>\n            <motion.div\n              className={cx(\n                'absolute bg-background p-3 border rounded-full flex flex-row items-center',\n                {\n                  'bg-primary text-primary-foreground': currentLevel !== 2,\n                  'bg-background text-foreground': currentLevel === 2,\n                },\n              )}\n              style={{ y }}\n              drag=\"y\"\n              dragElastic={0}\n              dragMomentum={false}\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              transition={{ duration: 0.1 }}\n              dragConstraints={{ top: -dragConstraints, bottom: 0 }}\n              onDragStart={() => {\n                setHasUserSelectedLevel(false);\n              }}\n              onDragEnd={() => {\n                if (currentLevel === 2) {\n                  setSelectedTool(null);\n                } else {\n                  setHasUserSelectedLevel(true);\n                }\n              }}\n              onClick={() => {\n                if (currentLevel !== 2 && hasUserSelectedLevel) {\n                  append({\n                    role: 'user',\n                    content: `Please adjust the reading level to ${LEVELS[currentLevel]} level.`,\n                  });\n\n                  setSelectedTool(null);\n                }\n              }}\n            >\n              {currentLevel === 2 ? <SummarizeIcon /> : <ArrowUpIcon />}\n            </motion.div>\n          </TooltipTrigger>\n          <TooltipContent\n            side=\"left\"\n            sideOffset={16}\n            className=\"bg-foreground text-background text-sm rounded-2xl p-3 px-4\"\n          >\n            {LEVELS[currentLevel]}\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    </div>\n  );\n};\n\nconst toolsByBlockKind: Record<\n  BlockKind,\n  Array<{\n    type:\n      | 'final-polish'\n      | 'request-suggestions'\n      | 'adjust-reading-level'\n      | 'code-review'\n      | 'add-comments'\n      | 'add-logs';\n    description: string;\n    icon: JSX.Element;\n  }>\n> = {\n  text: [\n    {\n      type: 'final-polish',\n      description: 'Add final polish',\n      icon: <PenIcon />,\n    },\n    {\n      type: 'adjust-reading-level',\n      description: 'Adjust reading level',\n      icon: <SummarizeIcon />,\n    },\n    {\n      type: 'request-suggestions',\n      description: 'Request suggestions',\n      icon: <MessageIcon />,\n    },\n  ],\n  code: [\n    {\n      type: 'add-comments',\n      description: 'Add comments',\n      icon: <CodeIcon />,\n    },\n    {\n      type: 'add-logs',\n      description: 'Add logs',\n      icon: <LogsIcon />,\n    },\n  ],\n};\n\nexport const Tools = ({\n  isToolbarVisible,\n  selectedTool,\n  setSelectedTool,\n  append,\n  isAnimating,\n  setIsToolbarVisible,\n  blockKind,\n}: {\n  isToolbarVisible: boolean;\n  selectedTool: string | null;\n  setSelectedTool: Dispatch<SetStateAction<string | null>>;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  isAnimating: boolean;\n  setIsToolbarVisible: Dispatch<SetStateAction<boolean>>;\n  blockKind: 'text' | 'code';\n}) => {\n  const [primaryTool, ...secondaryTools] = toolsByBlockKind[blockKind];\n\n  return (\n    <motion.div\n      className=\"flex flex-col gap-1.5\"\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n    >\n      <AnimatePresence>\n        {isToolbarVisible &&\n          secondaryTools.map((secondaryTool) => (\n            <Tool\n              key={secondaryTool.type}\n              type={secondaryTool.type}\n              description={secondaryTool.description}\n              icon={secondaryTool.icon}\n              selectedTool={selectedTool}\n              setSelectedTool={setSelectedTool}\n              append={append}\n              isAnimating={isAnimating}\n            />\n          ))}\n      </AnimatePresence>\n\n      <Tool\n        type={primaryTool.type}\n        description={primaryTool.description}\n        icon={primaryTool.icon}\n        selectedTool={selectedTool}\n        setSelectedTool={setSelectedTool}\n        isToolbarVisible={isToolbarVisible}\n        setIsToolbarVisible={setIsToolbarVisible}\n        append={append}\n        isAnimating={isAnimating}\n      />\n    </motion.div>\n  );\n};\n\nconst PureToolbar = ({\n  isToolbarVisible,\n  setIsToolbarVisible,\n  append,\n  isLoading,\n  stop,\n  setMessages,\n  blockKind,\n}: {\n  isToolbarVisible: boolean;\n  setIsToolbarVisible: Dispatch<SetStateAction<boolean>>;\n  isLoading: boolean;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  stop: () => void;\n  setMessages: Dispatch<SetStateAction<Message[]>>;\n  blockKind: 'text' | 'code';\n}) => {\n  const toolbarRef = useRef<HTMLDivElement>(null);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout>>();\n\n  const [selectedTool, setSelectedTool] = useState<string | null>(null);\n  const [isAnimating, setIsAnimating] = useState(false);\n\n  useOnClickOutside(toolbarRef, () => {\n    setIsToolbarVisible(false);\n    setSelectedTool(null);\n  });\n\n  const startCloseTimer = () => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    timeoutRef.current = setTimeout(() => {\n      setSelectedTool(null);\n      setIsToolbarVisible(false);\n    }, 2000);\n  };\n\n  const cancelCloseTimer = () => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n  };\n\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (isLoading) {\n      setIsToolbarVisible(false);\n    }\n  }, [isLoading, setIsToolbarVisible]);\n\n  return (\n    <TooltipProvider delayDuration={0}>\n      <motion.div\n        className=\"cursor-pointer absolute right-6 bottom-6 p-1.5 border rounded-full shadow-lg bg-background flex flex-col justify-end\"\n        initial={{ opacity: 0, y: -20, scale: 1 }}\n        animate={\n          isToolbarVisible\n            ? selectedTool === 'adjust-reading-level'\n              ? {\n                  opacity: 1,\n                  y: 0,\n                  height: 6 * 43,\n                  transition: { delay: 0 },\n                  scale: 0.95,\n                }\n              : {\n                  opacity: 1,\n                  y: 0,\n                  height: toolsByBlockKind[blockKind].length * 50,\n                  transition: { delay: 0 },\n                  scale: 1,\n                }\n            : { opacity: 1, y: 0, height: 54, transition: { delay: 0 } }\n        }\n        exit={{ opacity: 0, y: -20, transition: { duration: 0.1 } }}\n        transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n        onHoverStart={() => {\n          if (isLoading) return;\n\n          cancelCloseTimer();\n          setIsToolbarVisible(true);\n        }}\n        onHoverEnd={() => {\n          if (isLoading) return;\n\n          startCloseTimer();\n        }}\n        onAnimationStart={() => {\n          setIsAnimating(true);\n        }}\n        onAnimationComplete={() => {\n          setIsAnimating(false);\n        }}\n        ref={toolbarRef}\n      >\n        {isLoading ? (\n          <motion.div\n            key=\"stop-icon\"\n            initial={{ scale: 1 }}\n            animate={{ scale: 1.4 }}\n            exit={{ scale: 1 }}\n            className=\"p-3\"\n            onClick={() => {\n              stop();\n              setMessages((messages) => sanitizeUIMessages(messages));\n            }}\n          >\n            <StopIcon />\n          </motion.div>\n        ) : selectedTool === 'adjust-reading-level' ? (\n          <ReadingLevelSelector\n            key=\"reading-level-selector\"\n            append={append}\n            setSelectedTool={setSelectedTool}\n            isAnimating={isAnimating}\n          />\n        ) : (\n          <Tools\n            key=\"tools\"\n            append={append}\n            isAnimating={isAnimating}\n            isToolbarVisible={isToolbarVisible}\n            selectedTool={selectedTool}\n            setIsToolbarVisible={setIsToolbarVisible}\n            setSelectedTool={setSelectedTool}\n            blockKind={blockKind}\n          />\n        )}\n      </motion.div>\n    </TooltipProvider>\n  );\n};\n\nexport const Toolbar = memo(PureToolbar, (prevProps, nextProps) => {\n  if (prevProps.isLoading !== nextProps.isLoading) return false;\n  if (prevProps.isToolbarVisible !== nextProps.isToolbarVisible) return false;\n  if (prevProps.blockKind !== nextProps.blockKind) return false;\n\n  return true;\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3262, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3268, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/hooks/use-block.ts"],"sourcesContent":["'use client';\n\nimport { UIBlock } from '@/components/block';\nimport { useCallback, useMemo } from 'react';\nimport useSWR from 'swr';\n\nexport const initialBlockData: UIBlock = {\n  documentId: 'init',\n  content: '',\n  kind: 'text',\n  title: '',\n  status: 'idle',\n  isVisible: false,\n  boundingBox: {\n    top: 0,\n    left: 0,\n    width: 0,\n    height: 0,\n  },\n};\n\n// Add type for selector function\ntype Selector<T> = (state: UIBlock) => T;\n\nexport function useBlockSelector<Selected>(selector: Selector<Selected>) {\n  const { data: localBlock } = useSWR<UIBlock>('block', null, {\n    fallbackData: initialBlockData,\n  });\n\n  const selectedValue = useMemo(() => {\n    if (!localBlock) return selector(initialBlockData);\n    return selector(localBlock);\n  }, [localBlock, selector]);\n\n  return selectedValue;\n}\n\nexport function useBlock() {\n  const { data: localBlock, mutate: setLocalBlock } = useSWR<UIBlock>(\n    'block',\n    null,\n    {\n      fallbackData: initialBlockData,\n    },\n  );\n\n  const block = useMemo(() => {\n    if (!localBlock) return initialBlockData;\n    return localBlock;\n  }, [localBlock]);\n\n  const setBlock = useCallback(\n    (updaterFn: UIBlock | ((currentBlock: UIBlock) => UIBlock)) => {\n      setLocalBlock((currentBlock) => {\n        const blockToUpdate = currentBlock || initialBlockData;\n\n        if (typeof updaterFn === 'function') {\n          return updaterFn(blockToUpdate);\n        }\n\n        return updaterFn;\n      });\n    },\n    [setLocalBlock],\n  );\n\n  return useMemo(() => ({ block, setBlock }), [block, setBlock]);\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;;AAJA;;;AAMO,MAAM,mBAA4B;IACvC,YAAY;IACZ,SAAS;IACT,MAAM;IACN,OAAO;IACP,QAAQ;IACR,WAAW;IACX,aAAa;QACX,KAAK;QACL,MAAM;QACN,OAAO;QACP,QAAQ;IACV;AACF;AAKO,SAAS,iBAA2B,QAA4B;;IACrE,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,CAAA,GAAA,iKAAA,CAAA,UAAM,AAAD,EAAW,SAAS,MAAM;QAC1D,cAAc;IAChB;IAEA,MAAM,gBAAgB,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD;mDAAE;YAC5B,IAAI,CAAC,YAAY,OAAO,SAAS;YACjC,OAAO,SAAS;QAClB;kDAAG;QAAC;QAAY;KAAS;IAEzB,OAAO;AACT;GAXgB;;QACe,iKAAA,CAAA,UAAM;;;AAY9B,SAAS;;IACd,MAAM,EAAE,MAAM,UAAU,EAAE,QAAQ,aAAa,EAAE,GAAG,CAAA,GAAA,iKAAA,CAAA,UAAM,AAAD,EACvD,SACA,MACA;QACE,cAAc;IAChB;IAGF,MAAM,QAAQ,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD;mCAAE;YACpB,IAAI,CAAC,YAAY,OAAO;YACxB,OAAO;QACT;kCAAG;QAAC;KAAW;IAEf,MAAM,WAAW,CAAA,GAAA,6KAAA,CAAA,cAAW,AAAD;0CACzB,CAAC;YACC;kDAAc,CAAC;oBACb,MAAM,gBAAgB,gBAAgB;oBAEtC,IAAI,OAAO,cAAc,YAAY;wBACnC,OAAO,UAAU;oBACnB;oBAEA,OAAO;gBACT;;QACF;yCACA;QAAC;KAAc;IAGjB,OAAO,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD;4BAAE,IAAM,CAAC;gBAAE;gBAAO;YAAS,CAAC;2BAAG;QAAC;QAAO;KAAS;AAC/D;IA9BgB;;QACsC,iKAAA,CAAA,UAAM"}},
    {"offset": {"line": 3360, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3366, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/version-footer.tsx"],"sourcesContent":["'use client';\n\nimport { isAfter } from 'date-fns';\nimport { motion } from 'framer-motion';\nimport { useState } from 'react';\nimport { useSWRConfig } from 'swr';\nimport { useWindowSize } from 'usehooks-ts';\n\nimport type { Document } from '@/lib/db/schema';\nimport { getDocumentTimestampByIndex } from '@/lib/utils';\n\nimport type { UIBlock } from './block';\nimport { LoaderIcon } from './icons';\nimport { Button } from './ui/button';\nimport { useBlock } from '@/hooks/use-block';\n\ninterface VersionFooterProps {\n  handleVersionChange: (type: 'next' | 'prev' | 'toggle' | 'latest') => void;\n  documents: Array<Document> | undefined;\n  currentVersionIndex: number;\n}\n\nexport const VersionFooter = ({\n  handleVersionChange,\n  documents,\n  currentVersionIndex,\n}: VersionFooterProps) => {\n  const { block } = useBlock();\n\n  const { width } = useWindowSize();\n  const isMobile = width < 768;\n\n  const { mutate } = useSWRConfig();\n  const [isMutating, setIsMutating] = useState(false);\n\n  if (!documents) return;\n\n  return (\n    <motion.div\n      className=\"absolute flex flex-col gap-4 lg:flex-row bottom-0 bg-background p-4 w-full border-t z-50 justify-between\"\n      initial={{ y: isMobile ? 200 : 77 }}\n      animate={{ y: 0 }}\n      exit={{ y: isMobile ? 200 : 77 }}\n      transition={{ type: 'spring', stiffness: 140, damping: 20 }}\n    >\n      <div>\n        <div>You are viewing a previous version</div>\n        <div className=\"text-muted-foreground text-sm\">\n          Restore this version to make edits\n        </div>\n      </div>\n\n      <div className=\"flex flex-row gap-4\">\n        <Button\n          disabled={isMutating}\n          onClick={async () => {\n            setIsMutating(true);\n\n            mutate(\n              `/api/document?id=${block.documentId}`,\n              await fetch(`/api/document?id=${block.documentId}`, {\n                method: 'PATCH',\n                body: JSON.stringify({\n                  timestamp: getDocumentTimestampByIndex(\n                    documents,\n                    currentVersionIndex,\n                  ),\n                }),\n              }),\n              {\n                optimisticData: documents\n                  ? [\n                      ...documents.filter((document) =>\n                        isAfter(\n                          new Date(document.createdAt),\n                          new Date(\n                            getDocumentTimestampByIndex(\n                              documents,\n                              currentVersionIndex,\n                            ),\n                          ),\n                        ),\n                      ),\n                    ]\n                  : [],\n              },\n            );\n          }}\n        >\n          <div>Restore this version</div>\n          {isMutating && (\n            <div className=\"animate-spin\">\n              <LoaderIcon />\n            </div>\n          )}\n        </Button>\n        <Button\n          variant=\"outline\"\n          onClick={() => {\n            handleVersionChange('latest');\n          }}\n        >\n          Back to latest version\n        </Button>\n      </div>\n    </motion.div>\n  );\n};\n"],"names":[],"mappings":";;;;AAIA;AAKA;AAGA;AACA;AACA;AARA;AADA;AAFA;AADA;;;AAFA;;;;;;;;;;AAsBO,MAAM,gBAAgB,CAAC,EAC5B,mBAAmB,EACnB,SAAS,EACT,mBAAmB,EACA;;IACnB,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,wHAAA,CAAA,WAAQ,AAAD;IAEzB,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,kJAAA,CAAA,gBAAa,AAAD;IAC9B,MAAM,WAAW,QAAQ;IAEzB,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,qKAAA,CAAA,eAAY,AAAD;IAC9B,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,IAAI,CAAC,WAAW;IAEhB,qBACE,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;QACT,WAAU;QACV,SAAS;YAAE,GAAG,WAAW,MAAM;QAAG;QAClC,SAAS;YAAE,GAAG;QAAE;QAChB,MAAM;YAAE,GAAG,WAAW,MAAM;QAAG;QAC/B,YAAY;YAAE,MAAM;YAAU,WAAW;YAAK,SAAS;QAAG;;0BAE1D,6MAAC;;kCACC,6MAAC;kCAAI;;;;;;kCACL,6MAAC;wBAAI,WAAU;kCAAgC;;;;;;;;;;;;0BAKjD,6MAAC;gBAAI,WAAU;;kCACb,6MAAC,8HAAA,CAAA,SAAM;wBACL,UAAU;wBACV,SAAS;4BACP,cAAc;4BAEd,OACE,CAAC,iBAAiB,EAAE,MAAM,UAAU,EAAE,EACtC,MAAM,MAAM,CAAC,iBAAiB,EAAE,MAAM,UAAU,EAAE,EAAE;gCAClD,QAAQ;gCACR,MAAM,KAAK,SAAS,CAAC;oCACnB,WAAW,CAAA,GAAA,+GAAA,CAAA,8BAA2B,AAAD,EACnC,WACA;gCAEJ;4BACF,IACA;gCACE,gBAAgB,YACZ;uCACK,UAAU,MAAM,CAAC,CAAC,WACnB,CAAA,GAAA,yIAAA,CAAA,UAAO,AAAD,EACJ,IAAI,KAAK,SAAS,SAAS,GAC3B,IAAI,KACF,CAAA,GAAA,+GAAA,CAAA,8BAA2B,AAAD,EACxB,WACA;iCAKT,GACD,EAAE;4BACR;wBAEJ;;0CAEA,6MAAC;0CAAI;;;;;;4BACJ,4BACC,6MAAC;gCAAI,WAAU;0CACb,cAAA,6MAAC,uHAAA,CAAA,aAAU;;;;;;;;;;;;;;;;kCAIjB,6MAAC,8HAAA,CAAA,SAAM;wBACL,SAAQ;wBACR,SAAS;4BACP,oBAAoB;wBACtB;kCACD;;;;;;;;;;;;;;;;;;AAMT;GArFa;;QAKO,wHAAA,CAAA,WAAQ;QAER,kJAAA,CAAA,gBAAa;QAGZ,qKAAA,CAAA,eAAY;;;KAVpB"}},
    {"offset": {"line": 3520, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3526, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/block-actions.tsx"],"sourcesContent":["import { cn, generateUUID } from '@/lib/utils';\nimport { ClockRewind, CopyIcon, PlayIcon, RedoIcon, UndoIcon } from './icons';\nimport { Button } from './ui/button';\nimport { Tooltip, TooltipContent, TooltipTrigger } from './ui/tooltip';\nimport { useCopyToClipboard } from 'usehooks-ts';\nimport { toast } from 'sonner';\nimport { ConsoleOutput, UIBlock } from './block';\nimport {\n  Dispatch,\n  memo,\n  SetStateAction,\n  startTransition,\n  useCallback,\n  useState,\n} from 'react';\n\ninterface BlockActionsProps {\n  block: UIBlock;\n  handleVersionChange: (type: 'next' | 'prev' | 'toggle' | 'latest') => void;\n  currentVersionIndex: number;\n  isCurrentVersion: boolean;\n  mode: 'read-only' | 'edit' | 'diff';\n  setConsoleOutputs: Dispatch<SetStateAction<Array<ConsoleOutput>>>;\n}\n\nexport function RunCodeButton({\n  block,\n  setConsoleOutputs,\n}: {\n  block: UIBlock;\n  setConsoleOutputs: Dispatch<SetStateAction<Array<ConsoleOutput>>>;\n}) {\n  const [pyodide, setPyodide] = useState<any>(null);\n  const isPython = true;\n  const codeContent = block.content;\n\n  const updateConsoleOutput = useCallback(\n    (runId: string, content: string | null, status: 'completed' | 'failed') => {\n      setConsoleOutputs((consoleOutputs) => {\n        const index = consoleOutputs.findIndex((output) => output.id === runId);\n\n        if (index === -1) return consoleOutputs;\n\n        const updatedOutputs = [...consoleOutputs];\n        updatedOutputs[index] = {\n          id: runId,\n          content,\n          status,\n        };\n\n        return updatedOutputs;\n      });\n    },\n    [setConsoleOutputs],\n  );\n\n  const loadAndRunPython = useCallback(async () => {\n    const runId = generateUUID();\n\n    setConsoleOutputs((consoleOutputs) => [\n      ...consoleOutputs,\n      {\n        id: runId,\n        content: null,\n        status: 'in_progress',\n      },\n    ]);\n\n    let currentPyodideInstance = pyodide;\n\n    if (isPython) {\n      if (!currentPyodideInstance) {\n        // @ts-expect-error - pyodide is not defined\n        const newPyodideInstance = await loadPyodide({\n          indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.23.4/full/',\n        });\n\n        setPyodide(newPyodideInstance);\n        currentPyodideInstance = newPyodideInstance;\n      }\n\n      try {\n        await currentPyodideInstance.runPythonAsync(`\n            import sys\n            import io\n            sys.stdout = io.StringIO()\n          `);\n\n        await currentPyodideInstance.runPythonAsync(codeContent);\n\n        const output: string = await currentPyodideInstance.runPythonAsync(\n          `sys.stdout.getvalue()`,\n        );\n\n        updateConsoleOutput(runId, output, 'completed');\n      } catch (error: any) {\n        updateConsoleOutput(runId, error.message, 'failed');\n      }\n    }\n  }, [pyodide, codeContent, isPython, setConsoleOutputs, updateConsoleOutput]);\n\n  return (\n    <Button\n      variant=\"outline\"\n      className=\"py-1.5 px-2 h-fit dark:hover:bg-zinc-700\"\n      onClick={() => {\n        startTransition(() => {\n          loadAndRunPython();\n        });\n      }}\n      disabled={block.status === 'streaming'}\n    >\n      <PlayIcon size={18} /> Run\n    </Button>\n  );\n}\n\nfunction PureBlockActions({\n  block,\n  handleVersionChange,\n  currentVersionIndex,\n  isCurrentVersion,\n  mode,\n  setConsoleOutputs,\n}: BlockActionsProps) {\n  const [_, copyToClipboard] = useCopyToClipboard();\n\n  return (\n    <div className=\"flex flex-row gap-1\">\n      {block.kind === 'code' && (\n        <RunCodeButton block={block} setConsoleOutputs={setConsoleOutputs} />\n      )}\n\n      {block.kind === 'text' && (\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"outline\"\n              className={cn(\n                'p-2 h-fit !pointer-events-auto dark:hover:bg-zinc-700',\n                {\n                  'bg-muted': mode === 'diff',\n                },\n              )}\n              onClick={() => {\n                handleVersionChange('toggle');\n              }}\n              disabled={\n                block.status === 'streaming' || currentVersionIndex === 0\n              }\n            >\n              <ClockRewind size={18} />\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>View changes</TooltipContent>\n        </Tooltip>\n      )}\n\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className=\"p-2 h-fit dark:hover:bg-zinc-700 !pointer-events-auto\"\n            onClick={() => {\n              handleVersionChange('prev');\n            }}\n            disabled={currentVersionIndex === 0 || block.status === 'streaming'}\n          >\n            <UndoIcon size={18} />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>View Previous version</TooltipContent>\n      </Tooltip>\n\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className=\"p-2 h-fit dark:hover:bg-zinc-700 !pointer-events-auto\"\n            onClick={() => {\n              handleVersionChange('next');\n            }}\n            disabled={isCurrentVersion || block.status === 'streaming'}\n          >\n            <RedoIcon size={18} />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>View Next version</TooltipContent>\n      </Tooltip>\n\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className=\"p-2 h-fit dark:hover:bg-zinc-700\"\n            onClick={() => {\n              copyToClipboard(block.content);\n              toast.success('Copied to clipboard!');\n            }}\n            disabled={block.status === 'streaming'}\n          >\n            <CopyIcon size={18} />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>Copy to clipboard</TooltipContent>\n      </Tooltip>\n    </div>\n  );\n}\n\nexport const BlockActions = memo(PureBlockActions, (prevProps, nextProps) => {\n  if (prevProps.block.status !== nextProps.block.status) return false;\n  if (prevProps.currentVersionIndex !== nextProps.currentVersionIndex)\n    return false;\n  if (prevProps.isCurrentVersion !== nextProps.isCurrentVersion) return false;\n\n  return true;\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3854, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3860, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/block-close-button.tsx"],"sourcesContent":["import { memo } from 'react';\nimport { CrossIcon } from './icons';\nimport { Button } from './ui/button';\nimport { initialBlockData, useBlock } from '@/hooks/use-block';\n\nfunction PureBlockCloseButton() {\n  const { setBlock } = useBlock();\n\n  return (\n    <Button\n      variant=\"outline\"\n      className=\"h-fit p-2 dark:hover:bg-zinc-700\"\n      onClick={() => {\n        setBlock((currentBlock) =>\n          currentBlock.status === 'streaming'\n            ? {\n                ...currentBlock,\n                isVisible: false,\n              }\n            : { ...initialBlockData, status: 'idle' },\n        );\n      }}\n    >\n      <CrossIcon size={18} />\n    </Button>\n  );\n}\n\nexport const BlockCloseButton = memo(PureBlockCloseButton, () => true);\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;AAEA,SAAS;;IACP,MAAM,EAAE,QAAQ,EAAE,GAAG,CAAA,GAAA,wHAAA,CAAA,WAAQ,AAAD;IAE5B,qBACE,6MAAC,8HAAA,CAAA,SAAM;QACL,SAAQ;QACR,WAAU;QACV,SAAS;YACP,SAAS,CAAC,eACR,aAAa,MAAM,KAAK,cACpB;oBACE,GAAG,YAAY;oBACf,WAAW;gBACb,IACA;oBAAE,GAAG,wHAAA,CAAA,mBAAgB;oBAAE,QAAQ;gBAAO;QAE9C;kBAEA,cAAA,6MAAC,uHAAA,CAAA,YAAS;YAAC,MAAM;;;;;;;;;;;AAGvB;GArBS;;QACc,wHAAA,CAAA,WAAQ;;;KADtB;AAuBF,MAAM,iCAAmB,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAAE,sBAAsB,IAAM"}},
    {"offset": {"line": 3916, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 3922, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/message-actions.tsx"],"sourcesContent":["import type { Message } from 'ai';\nimport { toast } from 'sonner';\nimport { useSWRConfig } from 'swr';\nimport { useCopyToClipboard } from 'usehooks-ts';\n\nimport type { Vote } from '@/lib/db/schema';\nimport { getMessageIdFromAnnotations } from '@/lib/utils';\n\nimport { CopyIcon, ThumbDownIcon, ThumbUpIcon } from './icons';\nimport { Button } from './ui/button';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from './ui/tooltip';\nimport { memo } from 'react';\nimport equal from 'fast-deep-equal';\n\nexport function PureMessageActions({\n  chatId,\n  message,\n  vote,\n  isLoading,\n}: {\n  chatId: string;\n  message: Message;\n  vote: Vote | undefined;\n  isLoading: boolean;\n}) {\n  const { mutate } = useSWRConfig();\n  const [_, copyToClipboard] = useCopyToClipboard();\n\n  if (isLoading) return null;\n  if (message.role === 'user') return null;\n  if (message.toolInvocations && message.toolInvocations.length > 0)\n    return null;\n\n  return (\n    <TooltipProvider delayDuration={0}>\n      <div className=\"flex flex-row gap-2\">\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              className=\"py-1 px-2 h-fit text-muted-foreground\"\n              variant=\"outline\"\n              onClick={async () => {\n                await copyToClipboard(message.content as string);\n                toast.success('Copied to clipboard!');\n              }}\n            >\n              <CopyIcon />\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>Copy</TooltipContent>\n        </Tooltip>\n  \n      </div>\n    </TooltipProvider>\n  );\n}\n\nexport const MessageActions = memo(\n  PureMessageActions,\n  (prevProps, nextProps) => {\n    if (!equal(prevProps.vote, nextProps.vote)) return false;\n    if (prevProps.isLoading !== nextProps.isLoading) return false;\n\n    return true;\n  },\n);\n"],"names":[],"mappings":";;;;;AACA;AAOA;AACA;AACA;AAMA;AACA;AAfA;AACA;;;;;;;;;;;AAgBO,SAAS,mBAAmB,EACjC,MAAM,EACN,OAAO,EACP,IAAI,EACJ,SAAS,EAMV;;IACC,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,qKAAA,CAAA,eAAY,AAAD;IAC9B,MAAM,CAAC,GAAG,gBAAgB,GAAG,CAAA,GAAA,kJAAA,CAAA,qBAAkB,AAAD;IAE9C,IAAI,WAAW,OAAO;IACtB,IAAI,QAAQ,IAAI,KAAK,QAAQ,OAAO;IACpC,IAAI,QAAQ,eAAe,IAAI,QAAQ,eAAe,CAAC,MAAM,GAAG,GAC9D,OAAO;IAET,qBACE,6MAAC,+HAAA,CAAA,kBAAe;QAAC,eAAe;kBAC9B,cAAA,6MAAC;YAAI,WAAU;sBACb,cAAA,6MAAC,+HAAA,CAAA,UAAO;;kCACN,6MAAC,+HAAA,CAAA,iBAAc;wBAAC,OAAO;kCACrB,cAAA,6MAAC,8HAAA,CAAA,SAAM;4BACL,WAAU;4BACV,SAAQ;4BACR,SAAS;gCACP,MAAM,gBAAgB,QAAQ,OAAO;gCACrC,2IAAA,CAAA,QAAK,CAAC,OAAO,CAAC;4BAChB;sCAEA,cAAA,6MAAC,uHAAA,CAAA,WAAQ;;;;;;;;;;;;;;;kCAGb,6MAAC,+HAAA,CAAA,iBAAc;kCAAC;;;;;;;;;;;;;;;;;;;;;;AAM1B;GAzCgB;;QAWK,qKAAA,CAAA,eAAY;QACF,kJAAA,CAAA,qBAAkB;;;KAZjC;AA2CT,MAAM,+BAAiB,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAC/B,oBACA,CAAC,WAAW;IACV,IAAI,CAAC,CAAA,GAAA,iJAAA,CAAA,UAAK,AAAD,EAAE,UAAU,IAAI,EAAE,UAAU,IAAI,GAAG,OAAO;IACnD,IAAI,UAAU,SAAS,KAAK,UAAU,SAAS,EAAE,OAAO;IAExD,OAAO;AACT"}},
    {"offset": {"line": 4025, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4031, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/hooks/use-user-message-id.ts"],"sourcesContent":["'use client';\n\nimport useSWR from 'swr';\n\nexport function useUserMessageId() {\n  const { data: userMessageIdFromServer, mutate: setUserMessageIdFromServer } =\n    useSWR('userMessageIdFromServer', null);\n\n  return { userMessageIdFromServer, setUserMessageIdFromServer };\n}\n"],"names":[],"mappings":";;;AAEA;;AAFA;;AAIO,SAAS;;IACd,MAAM,EAAE,MAAM,uBAAuB,EAAE,QAAQ,0BAA0B,EAAE,GACzE,CAAA,GAAA,iKAAA,CAAA,UAAM,AAAD,EAAE,2BAA2B;IAEpC,OAAO;QAAE;QAAyB;IAA2B;AAC/D;GALgB;;QAEZ,iKAAA,CAAA,UAAM"}},
    {"offset": {"line": 4054, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4060, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/message-editor.tsx"],"sourcesContent":["'use client';\n\nimport { ChatRequestOptions, Message } from 'ai';\nimport { Button } from './ui/button';\nimport { Dispatch, SetStateAction, useEffect, useRef, useState } from 'react';\nimport { Textarea } from './ui/textarea';\nimport { deleteTrailingMessages } from '@/app/(chat)/actions';\nimport { toast } from 'sonner';\nimport { useUserMessageId } from '@/hooks/use-user-message-id';\n\nexport type MessageEditorProps = {\n  message: Message;\n  setMode: Dispatch<SetStateAction<'view' | 'edit'>>;\n  setMessages: (\n    messages: Message[] | ((messages: Message[]) => Message[]),\n  ) => void;\n  reload: (\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n};\n\nexport function MessageEditor({\n  message,\n  setMode,\n  setMessages,\n  reload,\n}: MessageEditorProps) {\n  const { userMessageIdFromServer } = useUserMessageId();\n  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);\n\n  const [draftContent, setDraftContent] = useState<string>(message.content);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  useEffect(() => {\n    if (textareaRef.current) {\n      adjustHeight();\n    }\n  }, []);\n\n  const adjustHeight = () => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto';\n      textareaRef.current.style.height = `${textareaRef.current.scrollHeight + 2}px`;\n    }\n  };\n\n  const handleInput = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setDraftContent(event.target.value);\n    adjustHeight();\n  };\n\n  return (\n    <div className=\"flex flex-col gap-2 w-full\">\n      <Textarea\n        ref={textareaRef}\n        className=\"bg-transparent outline-none overflow-hidden resize-none !text-base rounded-xl w-full\"\n        value={draftContent}\n        onChange={handleInput}\n      />\n\n      <div className=\"flex flex-row gap-2 justify-end\">\n        <Button\n          variant=\"outline\"\n          className=\"h-fit py-2 px-3\"\n          onClick={() => {\n            setMode('view');\n          }}\n        >\n          Cancel\n        </Button>\n        <Button\n          variant=\"default\"\n          className=\"h-fit py-2 px-3\"\n          disabled={isSubmitting}\n          onClick={async () => {\n            setIsSubmitting(true);\n            const messageId = userMessageIdFromServer ?? message.id;\n\n            if (!messageId) {\n              toast.error('Something went wrong, please try again!');\n              setIsSubmitting(false);\n              return;\n            }\n\n            await deleteTrailingMessages({\n              id: messageId,\n            });\n\n            setMessages((messages) => {\n              const index = messages.findIndex((m) => m.id === message.id);\n\n              if (index !== -1) {\n                const updatedMessage = {\n                  ...message,\n                  content: draftContent,\n                };\n\n                return [...messages.slice(0, index), updatedMessage];\n              }\n\n              return messages;\n            });\n\n            setMode('view');\n            reload();\n          }}\n        >\n          {isSubmitting ? 'Sending...' : 'Send'}\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;AAqBO,SAAS,cAAc,EAC5B,OAAO,EACP,OAAO,EACP,WAAW,EACX,MAAM,EACa;;IACnB,MAAM,EAAE,uBAAuB,EAAE,GAAG,CAAA,GAAA,wIAAA,CAAA,mBAAgB,AAAD;IACnD,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAW;IAE1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAU,QAAQ,OAAO;IACxE,MAAM,cAAc,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAuB;IAEhD,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;mCAAE;YACR,IAAI,YAAY,OAAO,EAAE;gBACvB;YACF;QACF;kCAAG,EAAE;IAEL,MAAM,eAAe;QACnB,IAAI,YAAY,OAAO,EAAE;YACvB,YAAY,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG;YACnC,YAAY,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,YAAY,OAAO,CAAC,YAAY,GAAG,EAAE,EAAE,CAAC;QAChF;IACF;IAEA,MAAM,cAAc,CAAC;QACnB,gBAAgB,MAAM,MAAM,CAAC,KAAK;QAClC;IACF;IAEA,qBACE,6MAAC;QAAI,WAAU;;0BACb,6MAAC,gIAAA,CAAA,WAAQ;gBACP,KAAK;gBACL,WAAU;gBACV,OAAO;gBACP,UAAU;;;;;;0BAGZ,6MAAC;gBAAI,WAAU;;kCACb,6MAAC,8HAAA,CAAA,SAAM;wBACL,SAAQ;wBACR,WAAU;wBACV,SAAS;4BACP,QAAQ;wBACV;kCACD;;;;;;kCAGD,6MAAC,8HAAA,CAAA,SAAM;wBACL,SAAQ;wBACR,WAAU;wBACV,UAAU;wBACV,SAAS;4BACP,gBAAgB;4BAChB,MAAM,YAAY,2BAA2B,QAAQ,EAAE;4BAEvD,IAAI,CAAC,WAAW;gCACd,2IAAA,CAAA,QAAK,CAAC,KAAK,CAAC;gCACZ,gBAAgB;gCAChB;4BACF;4BAEA,MAAM,CAAA,GAAA,6HAAA,CAAA,yBAAsB,AAAD,EAAE;gCAC3B,IAAI;4BACN;4BAEA,YAAY,CAAC;gCACX,MAAM,QAAQ,SAAS,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,EAAE;gCAE3D,IAAI,UAAU,CAAC,GAAG;oCAChB,MAAM,iBAAiB;wCACrB,GAAG,OAAO;wCACV,SAAS;oCACX;oCAEA,OAAO;2CAAI,SAAS,KAAK,CAAC,GAAG;wCAAQ;qCAAe;gCACtD;gCAEA,OAAO;4BACT;4BAEA,QAAQ;4BACR;wBACF;kCAEC,eAAe,eAAe;;;;;;;;;;;;;;;;;;AAKzC;GA3FgB;;QAMsB,wIAAA,CAAA,mBAAgB;;;KANtC"}},
    {"offset": {"line": 4192, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4198, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/message.tsx"],"sourcesContent":["'use client';\n\nimport type { ChatRequestOptions, Message } from 'ai';\nimport cx from 'classnames';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { memo, useMemo, useState } from 'react';\n\nimport type { Vote } from '@/lib/db/schema';\n\nimport { DocumentToolCall, DocumentToolResult } from './document';\nimport { PencilEditIcon, SparklesIcon } from './icons';\nimport { Markdown } from './markdown';\nimport { MessageActions } from './message-actions';\nimport { PreviewAttachment } from './preview-attachment';\nimport { Weather } from './weather';\nimport equal from 'fast-deep-equal';\nimport { cn } from '@/lib/utils';\nimport { Button } from './ui/button';\nimport { Tooltip, TooltipContent, TooltipTrigger } from './ui/tooltip';\nimport { MessageEditor } from './message-editor';\nimport { DocumentPreview } from './document-preview';\n\nconst PurePreviewMessage = ({\n  chatId,\n  message,\n  vote,\n  isLoading,\n  setMessages,\n  reload,\n  isReadonly,\n}: {\n  chatId: string;\n  message: Message;\n  vote: Vote | undefined;\n  isLoading: boolean;\n  setMessages: (\n    messages: Message[] | ((messages: Message[]) => Message[]),\n  ) => void;\n  reload: (\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  isReadonly: boolean;\n}) => {\n  const [mode, setMode] = useState<'view' | 'edit'>('view');\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        className=\"w-full mx-auto max-w-3xl px-4 group/message\"\n        initial={{ y: 5, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        data-role={message.role}\n      >\n        <div\n          className={cn(\n            'flex gap-4 w-full group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl',\n            {\n              'w-full': mode === 'edit',\n              'group-data-[role=user]/message:w-fit': mode !== 'edit',\n            },\n          )}\n        >\n          {message.role === 'assistant' && (\n            <div className=\"size-8 flex items-center rounded-full justify-center ring-1 shrink-0 ring-border bg-background\">\n              <div className=\"translate-y-px\">\n                <SparklesIcon size={14} />\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex flex-col gap-2 w-full\">\n            {message.experimental_attachments && (\n              <div className=\"flex flex-row justify-end gap-2\">\n                {message.experimental_attachments.map((attachment) => (\n                  <PreviewAttachment\n                    key={attachment.url}\n                    attachment={attachment}\n                  />\n                ))}\n              </div>\n            )}\n\n            {message.content && mode === 'view' && (\n              <div className=\"flex flex-row gap-2 items-start\">\n                {message.role === 'user' && !isReadonly && (\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        className=\"px-2 h-fit rounded-full text-muted-foreground opacity-0 group-hover/message:opacity-100\"\n                        onClick={() => {\n                          setMode('edit');\n                        }}\n                      >\n                        <PencilEditIcon />\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>Edit message</TooltipContent>\n                  </Tooltip>\n                )}\n\n                <div\n                  className={cn('flex flex-col gap-4', {\n                    'bg-primary text-primary-foreground px-3 py-2 rounded-xl':\n                      message.role === 'user',\n                  })}\n                >\n                  <Markdown>{message.content as string}</Markdown>\n                </div>\n              </div>\n            )}\n\n            {message.content && mode === 'edit' && (\n              <div className=\"flex flex-row gap-2 items-start\">\n                <div className=\"size-8\" />\n\n                <MessageEditor\n                  key={message.id}\n                  message={message}\n                  setMode={setMode}\n                  setMessages={setMessages}\n                  reload={reload}\n                />\n              </div>\n            )}\n\n          \n\n            {!isReadonly && (\n              <MessageActions\n                key={`action-${message.id}`}\n                chatId={chatId}\n                message={message}\n                vote={vote}\n                isLoading={isLoading}\n              />\n            )}\n          </div>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport const PreviewMessage = memo(\n  PurePreviewMessage,\n  (prevProps, nextProps) => {\n    if (prevProps.isLoading !== nextProps.isLoading) return false;\n    if (prevProps.message.content !== nextProps.message.content) return false;\n    if (\n      !equal(\n        prevProps.message.toolInvocations,\n        nextProps.message.toolInvocations,\n      )\n    )\n      return false;\n    if (!equal(prevProps.vote, nextProps.vote)) return false;\n\n    return true;\n  },\n);\n\nexport const ThinkingMessage = () => {\n  const role = 'assistant';\n\n  return (\n    <motion.div\n      className=\"w-full mx-auto max-w-3xl px-4 group/message \"\n      initial={{ y: 5, opacity: 0 }}\n      animate={{ y: 0, opacity: 1, transition: { delay: 1 } }}\n      data-role={role}\n    >\n      <div\n        className={cx(\n          'flex gap-4 group-data-[role=user]/message:px-3 w-full group-data-[role=user]/message:w-fit group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl group-data-[role=user]/message:py-2 rounded-xl',\n          {\n            'group-data-[role=user]/message:bg-muted': true,\n          },\n        )}\n      >\n        <div className=\"size-8 flex items-center rounded-full justify-center ring-1 shrink-0 ring-border\">\n          <SparklesIcon size={14} />\n        </div>\n\n        <div className=\"flex flex-col gap-2 w-full\">\n          <div className=\"flex flex-col gap-4 text-muted-foreground\">\n            Thinking...\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAfA;AAAA;;;AAJA;;;;;;;;;;;;;AAsBA,MAAM,qBAAqB,CAAC,EAC1B,MAAM,EACN,OAAO,EACP,IAAI,EACJ,SAAS,EACT,WAAW,EACX,MAAM,EACN,UAAU,EAaX;;IACC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAmB;IAElD,qBACE,6MAAC,4LAAA,CAAA,kBAAe;kBACd,cAAA,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;YACT,WAAU;YACV,SAAS;gBAAE,GAAG;gBAAG,SAAS;YAAE;YAC5B,SAAS;gBAAE,GAAG;gBAAG,SAAS;YAAE;YAC5B,aAAW,QAAQ,IAAI;sBAEvB,cAAA,6MAAC;gBACC,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,qGACA;oBACE,UAAU,SAAS;oBACnB,wCAAwC,SAAS;gBACnD;;oBAGD,QAAQ,IAAI,KAAK,6BAChB,6MAAC;wBAAI,WAAU;kCACb,cAAA,6MAAC;4BAAI,WAAU;sCACb,cAAA,6MAAC,uHAAA,CAAA,eAAY;gCAAC,MAAM;;;;;;;;;;;;;;;;kCAK1B,6MAAC;wBAAI,WAAU;;4BACZ,QAAQ,wBAAwB,kBAC/B,6MAAC;gCAAI,WAAU;0CACZ,QAAQ,wBAAwB,CAAC,GAAG,CAAC,CAAC,2BACrC,6MAAC,uIAAA,CAAA,oBAAiB;wCAEhB,YAAY;uCADP,WAAW,GAAG;;;;;;;;;;4BAO1B,QAAQ,OAAO,IAAI,SAAS,wBAC3B,6MAAC;gCAAI,WAAU;;oCACZ,QAAQ,IAAI,KAAK,UAAU,CAAC,4BAC3B,6MAAC,+HAAA,CAAA,UAAO;;0DACN,6MAAC,+HAAA,CAAA,iBAAc;gDAAC,OAAO;0DACrB,cAAA,6MAAC,8HAAA,CAAA,SAAM;oDACL,SAAQ;oDACR,WAAU;oDACV,SAAS;wDACP,QAAQ;oDACV;8DAEA,cAAA,6MAAC,uHAAA,CAAA,iBAAc;;;;;;;;;;;;;;;0DAGnB,6MAAC,+HAAA,CAAA,iBAAc;0DAAC;;;;;;;;;;;;kDAIpB,6MAAC;wCACC,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EAAE,uBAAuB;4CACnC,2DACE,QAAQ,IAAI,KAAK;wCACrB;kDAEA,cAAA,6MAAC,0HAAA,CAAA,WAAQ;sDAAE,QAAQ,OAAO;;;;;;;;;;;;;;;;;4BAK/B,QAAQ,OAAO,IAAI,SAAS,wBAC3B,6MAAC;gCAAI,WAAU;;kDACb,6MAAC;wCAAI,WAAU;;;;;;kDAEf,6MAAC,mIAAA,CAAA,gBAAa;wCAEZ,SAAS;wCACT,SAAS;wCACT,aAAa;wCACb,QAAQ;uCAJH,QAAQ,EAAE;;;;;;;;;;;4BAWpB,CAAC,4BACA,6MAAC,oIAAA,CAAA,iBAAc;gCAEb,QAAQ;gCACR,SAAS;gCACT,MAAM;gCACN,WAAW;+BAJN,CAAC,OAAO,EAAE,QAAQ,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;AAY3C;GAxHM;KAAA;AA0HC,MAAM,+BAAiB,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAC/B,oBACA,CAAC,WAAW;IACV,IAAI,UAAU,SAAS,KAAK,UAAU,SAAS,EAAE,OAAO;IACxD,IAAI,UAAU,OAAO,CAAC,OAAO,KAAK,UAAU,OAAO,CAAC,OAAO,EAAE,OAAO;IACpE,IACE,CAAC,CAAA,GAAA,iJAAA,CAAA,UAAK,AAAD,EACH,UAAU,OAAO,CAAC,eAAe,EACjC,UAAU,OAAO,CAAC,eAAe,GAGnC,OAAO;IACT,IAAI,CAAC,CAAA,GAAA,iJAAA,CAAA,UAAK,AAAD,EAAE,UAAU,IAAI,EAAE,UAAU,IAAI,GAAG,OAAO;IAEnD,OAAO;AACT;;AAGK,MAAM,kBAAkB;IAC7B,MAAM,OAAO;IAEb,qBACE,6MAAC,6LAAA,CAAA,SAAM,CAAC,GAAG;QACT,WAAU;QACV,SAAS;YAAE,GAAG;YAAG,SAAS;QAAE;QAC5B,SAAS;YAAE,GAAG;YAAG,SAAS;YAAG,YAAY;gBAAE,OAAO;YAAE;QAAE;QACtD,aAAW;kBAEX,cAAA,6MAAC;YACC,WAAW,CAAA,GAAA,sIAAA,CAAA,UAAE,AAAD,EACV,6NACA;gBACE,2CAA2C;YAC7C;;8BAGF,6MAAC;oBAAI,WAAU;8BACb,cAAA,6MAAC,uHAAA,CAAA,eAAY;wBAAC,MAAM;;;;;;;;;;;8BAGtB,6MAAC;oBAAI,WAAU;8BACb,cAAA,6MAAC;wBAAI,WAAU;kCAA4C;;;;;;;;;;;;;;;;;;;;;;AAOrE;MA9Ba"}},
    {"offset": {"line": 4492, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4498, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/use-scroll-to-bottom.ts"],"sourcesContent":["import { useEffect, useRef, type RefObject } from 'react';\n\nexport function useScrollToBottom<T extends HTMLElement>(): [\n  RefObject<T>,\n  RefObject<T>,\n] {\n  const containerRef = useRef<T>(null);\n  const endRef = useRef<T>(null);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    const end = endRef.current;\n\n    if (container && end) {\n      const observer = new MutationObserver(() => {\n        end.scrollIntoView({ behavior: 'instant', block: 'end' });\n      });\n\n      observer.observe(container, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        characterData: true,\n      });\n\n      return () => observer.disconnect();\n    }\n  }, []);\n\n  return [containerRef, endRef];\n}\n"],"names":[],"mappings":";;;AAAA;;;AAEO,SAAS;;IAId,MAAM,eAAe,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAK;IAC/B,MAAM,SAAS,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAK;IAEzB,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;uCAAE;YACR,MAAM,YAAY,aAAa,OAAO;YACtC,MAAM,MAAM,OAAO,OAAO;YAE1B,IAAI,aAAa,KAAK;gBACpB,MAAM,WAAW,IAAI;mDAAiB;wBACpC,IAAI,cAAc,CAAC;4BAAE,UAAU;4BAAW,OAAO;wBAAM;oBACzD;;gBAEA,SAAS,OAAO,CAAC,WAAW;oBAC1B,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,eAAe;gBACjB;gBAEA;mDAAO,IAAM,SAAS,UAAU;;YAClC;QACF;sCAAG,EAAE;IAEL,OAAO;QAAC;QAAc;KAAO;AAC/B;GA5BgB"}},
    {"offset": {"line": 4542, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4548, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/block-messages.tsx"],"sourcesContent":["import { PreviewMessage } from './message';\nimport { useScrollToBottom } from './use-scroll-to-bottom';\nimport { Vote } from '@/lib/db/schema';\nimport { ChatRequestOptions, Message } from 'ai';\nimport { memo } from 'react';\nimport equal from 'fast-deep-equal';\nimport { UIBlock } from './block';\n\ninterface BlockMessagesProps {\n  chatId: string;\n  isLoading: boolean;\n  votes: Array<Vote> | undefined;\n  messages: Array<Message>;\n  setMessages: (\n    messages: Message[] | ((messages: Message[]) => Message[]),\n  ) => void;\n  reload: (\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  isReadonly: boolean;\n  blockStatus: UIBlock['status'];\n}\n\nfunction PureBlockMessages({\n  chatId,\n  isLoading,\n  votes,\n  messages,\n  setMessages,\n  reload,\n  isReadonly,\n}: BlockMessagesProps) {\n  const [messagesContainerRef, messagesEndRef] =\n    useScrollToBottom<HTMLDivElement>();\n\n  return (\n    <div\n      ref={messagesContainerRef}\n      className=\"flex flex-col gap-4 h-full items-center overflow-y-scroll px-4 pt-20\"\n    >\n      {messages.map((message, index) => (\n        <PreviewMessage\n          chatId={chatId}\n          key={message.id}\n          message={message}\n          isLoading={isLoading && index === messages.length - 1}\n          vote={\n            votes\n              ? votes.find((vote) => vote.messageId === message.id)\n              : undefined\n          }\n          setMessages={setMessages}\n          reload={reload}\n          isReadonly={isReadonly}\n        />\n      ))}\n\n      <div\n        ref={messagesEndRef}\n        className=\"shrink-0 min-w-[24px] min-h-[24px]\"\n      />\n    </div>\n  );\n}\n\nfunction areEqual(\n  prevProps: BlockMessagesProps,\n  nextProps: BlockMessagesProps,\n) {\n  if (\n    prevProps.blockStatus === 'streaming' &&\n    nextProps.blockStatus === 'streaming'\n  )\n    return true;\n\n  if (prevProps.isLoading !== nextProps.isLoading) return false;\n  if (prevProps.isLoading && nextProps.isLoading) return false;\n  if (prevProps.messages.length !== nextProps.messages.length) return false;\n  if (!equal(prevProps.votes, nextProps.votes)) return false;\n\n  return true;\n}\n\nexport const BlockMessages = memo(PureBlockMessages, areEqual);\n"],"names":[],"mappings":";;;;AAAA;AACA;AAGA;AACA;;;;;;;AAkBA,SAAS,kBAAkB,EACzB,MAAM,EACN,SAAS,EACT,KAAK,EACL,QAAQ,EACR,WAAW,EACX,MAAM,EACN,UAAU,EACS;;IACnB,MAAM,CAAC,sBAAsB,eAAe,GAC1C,CAAA,GAAA,8IAAA,CAAA,oBAAiB,AAAD;IAElB,qBACE,6MAAC;QACC,KAAK;QACL,WAAU;;YAET,SAAS,GAAG,CAAC,CAAC,SAAS,sBACtB,6MAAC,yHAAA,CAAA,iBAAc;oBACb,QAAQ;oBAER,SAAS;oBACT,WAAW,aAAa,UAAU,SAAS,MAAM,GAAG;oBACpD,MACE,QACI,MAAM,IAAI,CAAC,CAAC,OAAS,KAAK,SAAS,KAAK,QAAQ,EAAE,IAClD;oBAEN,aAAa;oBACb,QAAQ;oBACR,YAAY;mBAVP,QAAQ,EAAE;;;;;0BAcnB,6MAAC;gBACC,KAAK;gBACL,WAAU;;;;;;;;;;;;AAIlB;GAxCS;;QAUL,8IAAA,CAAA,oBAAiB;;;KAVZ;AA0CT,SAAS,SACP,SAA6B,EAC7B,SAA6B;IAE7B,IACE,UAAU,WAAW,KAAK,eAC1B,UAAU,WAAW,KAAK,aAE1B,OAAO;IAET,IAAI,UAAU,SAAS,KAAK,UAAU,SAAS,EAAE,OAAO;IACxD,IAAI,UAAU,SAAS,IAAI,UAAU,SAAS,EAAE,OAAO;IACvD,IAAI,UAAU,QAAQ,CAAC,MAAM,KAAK,UAAU,QAAQ,CAAC,MAAM,EAAE,OAAO;IACpE,IAAI,CAAC,CAAA,GAAA,iJAAA,CAAA,UAAK,AAAD,EAAE,UAAU,KAAK,EAAE,UAAU,KAAK,GAAG,OAAO;IAErD,OAAO;AACT;AAEO,MAAM,8BAAgB,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAAE,mBAAmB"}},
    {"offset": {"line": 4619, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4625, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/code-editor.tsx"],"sourcesContent":["'use client';\n\nimport { EditorView } from '@codemirror/view';\nimport { EditorState, Transaction } from '@codemirror/state';\nimport { python } from '@codemirror/lang-python';\nimport { oneDark } from '@codemirror/theme-one-dark';\nimport { basicSetup } from 'codemirror';\nimport React, { memo, useEffect, useRef } from 'react';\nimport { Suggestion } from '@/lib/db/schema';\n\ntype EditorProps = {\n  content: string;\n  saveContent: (updatedContent: string, debounce: boolean) => void;\n  status: 'streaming' | 'idle';\n  isCurrentVersion: boolean;\n  currentVersionIndex: number;\n  suggestions: Array<Suggestion>;\n};\n\nfunction PureCodeEditor({ content, saveContent, status }: EditorProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const editorRef = useRef<EditorView | null>(null);\n\n  useEffect(() => {\n    if (containerRef.current && !editorRef.current) {\n      const startState = EditorState.create({\n        doc: content,\n        extensions: [basicSetup, python(), oneDark],\n      });\n\n      editorRef.current = new EditorView({\n        state: startState,\n        parent: containerRef.current,\n      });\n    }\n\n    return () => {\n      if (editorRef.current) {\n        editorRef.current.destroy();\n        editorRef.current = null;\n      }\n    };\n    // NOTE: we only want to run this effect once\n    // eslint-disable-next-line\n  }, []);\n\n  useEffect(() => {\n    if (editorRef.current) {\n      const updateListener = EditorView.updateListener.of((update) => {\n        if (update.docChanged) {\n          const transaction = update.transactions.find(\n            (tr) => !tr.annotation(Transaction.remote),\n          );\n\n          if (transaction) {\n            const newContent = update.state.doc.toString();\n            saveContent(newContent, true);\n          }\n        }\n      });\n\n      const newState = EditorState.create({\n        doc: editorRef.current.state.doc,\n        extensions: [basicSetup, python(), oneDark, updateListener],\n      });\n\n      editorRef.current.setState(newState);\n    }\n  }, [saveContent]);\n\n  useEffect(() => {\n    if (editorRef.current && content) {\n      const currentContent = editorRef.current.state.doc.toString();\n\n      if (status === 'streaming' || currentContent !== content) {\n        const transaction = editorRef.current.state.update({\n          changes: {\n            from: 0,\n            to: currentContent.length,\n            insert: content,\n          },\n          annotations: [Transaction.remote.of(true)],\n        });\n\n        editorRef.current.dispatch(transaction);\n      }\n    }\n  }, [content, status]);\n\n  return (\n    <div\n      className=\"relative not-prose w-full pb-[calc(80dvh)] text-sm\"\n      ref={containerRef}\n    />\n  );\n}\n\nfunction areEqual(prevProps: EditorProps, nextProps: EditorProps) {\n  if (prevProps.suggestions !== nextProps.suggestions) return false;\n  if (prevProps.currentVersionIndex !== nextProps.currentVersionIndex)\n    return false;\n  if (prevProps.isCurrentVersion !== nextProps.isCurrentVersion) return false;\n  if (prevProps.status === 'streaming' && nextProps.status === 'streaming')\n    return false;\n  if (prevProps.content !== nextProps.content) return false;\n\n  return true;\n}\n\nexport const CodeEditor = memo(PureCodeEditor, areEqual);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4757, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4763, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/console.tsx"],"sourcesContent":["import { TerminalWindowIcon, LoaderIcon, CrossSmallIcon } from './icons';\nimport { Button } from './ui/button';\nimport {\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { ConsoleOutput } from './block';\nimport { cn } from '@/lib/utils';\n\ninterface ConsoleProps {\n  consoleOutputs: Array<ConsoleOutput>;\n  setConsoleOutputs: Dispatch<SetStateAction<Array<ConsoleOutput>>>;\n}\n\nexport function Console({ consoleOutputs, setConsoleOutputs }: ConsoleProps) {\n  const [height, setHeight] = useState<number>(300);\n  const [isResizing, setIsResizing] = useState(false);\n  const consoleEndRef = useRef<HTMLDivElement>(null);\n\n  const minHeight = 100;\n  const maxHeight = 800;\n\n  const startResizing = useCallback(() => {\n    setIsResizing(true);\n  }, []);\n\n  const stopResizing = useCallback(() => {\n    setIsResizing(false);\n  }, []);\n\n  const resize = useCallback(\n    (e: MouseEvent) => {\n      if (isResizing) {\n        const newHeight = window.innerHeight - e.clientY;\n        if (newHeight >= minHeight && newHeight <= maxHeight) {\n          setHeight(newHeight);\n        }\n      }\n    },\n    [isResizing],\n  );\n\n  useEffect(() => {\n    window.addEventListener('mousemove', resize);\n    window.addEventListener('mouseup', stopResizing);\n    return () => {\n      window.removeEventListener('mousemove', resize);\n      window.removeEventListener('mouseup', stopResizing);\n    };\n  }, [resize, stopResizing]);\n\n  useEffect(() => {\n    consoleEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [consoleOutputs]);\n\n  return consoleOutputs.length > 0 ? (\n    <>\n      <div\n        className=\"h-2 w-full fixed cursor-ns-resize z-50\"\n        onMouseDown={startResizing}\n        style={{ bottom: height - 4 }}\n        role=\"slider\"\n        aria-valuenow={minHeight}\n      />\n\n      <div\n        className={cn(\n          'fixed flex flex-col bottom-0 dark:bg-zinc-900 bg-zinc-50 w-full border-t z-40 overflow-y-scroll dark:border-zinc-700 border-zinc-200',\n          {\n            'select-none': isResizing,\n          },\n        )}\n        style={{ height }}\n      >\n        <div className=\"flex flex-row justify-between items-center w-full h-fit border-b dark:border-zinc-700 border-zinc-200 px-2 py-1 sticky top-0 z-50 bg-muted\">\n          <div className=\"text-sm pl-2 dark:text-zinc-50 text-zinc-800 flex flex-row gap-3 items-center\">\n            <div className=\"text-muted-foreground\">\n              <TerminalWindowIcon />\n            </div>\n            <div>Console</div>\n          </div>\n          <Button\n            variant=\"ghost\"\n            className=\"size-fit p-1 hover:dark:bg-zinc-700 hover:bg-zinc-200\"\n            size=\"icon\"\n            onClick={() => setConsoleOutputs([])}\n          >\n            <CrossSmallIcon />\n          </Button>\n        </div>\n\n        <div>\n          {consoleOutputs.map((consoleOutput, index) => (\n            <div\n              key={consoleOutput.id}\n              className=\"px-4 py-2 flex flex-row text-sm border-b dark:border-zinc-700 border-zinc-200 dark:bg-zinc-900 bg-zinc-50 font-mono\"\n            >\n              <div\n                className={cn('w-12 shrink-0', {\n                  'text-muted-foreground':\n                    consoleOutput.status === 'in_progress',\n                  'text-emerald-500': consoleOutput.status === 'completed',\n                  'text-red-400': consoleOutput.status === 'failed',\n                })}\n              >\n                [{index + 1}]\n              </div>\n              {consoleOutput.status === 'in_progress' ? (\n                <div className=\"animate-spin size-fit self-center\">\n                  <LoaderIcon />\n                </div>\n              ) : (\n                <div className=\"dark:text-zinc-50 text-zinc-900 whitespace-pre-line\">\n                  {consoleOutput.content}\n                </div>\n              )}\n            </div>\n          ))}\n          <div ref={consoleEndRef} />\n        </div>\n      </div>\n    </>\n  ) : null;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AASA;;;;;;;AAOO,SAAS,QAAQ,EAAE,cAAc,EAAE,iBAAiB,EAAgB;;IACzE,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAU;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,gBAAgB,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAkB;IAE7C,MAAM,YAAY;IAClB,MAAM,YAAY;IAElB,MAAM,gBAAgB,CAAA,GAAA,6KAAA,CAAA,cAAW,AAAD;8CAAE;YAChC,cAAc;QAChB;6CAAG,EAAE;IAEL,MAAM,eAAe,CAAA,GAAA,6KAAA,CAAA,cAAW,AAAD;6CAAE;YAC/B,cAAc;QAChB;4CAAG,EAAE;IAEL,MAAM,SAAS,CAAA,GAAA,6KAAA,CAAA,cAAW,AAAD;uCACvB,CAAC;YACC,IAAI,YAAY;gBACd,MAAM,YAAY,OAAO,WAAW,GAAG,EAAE,OAAO;gBAChD,IAAI,aAAa,aAAa,aAAa,WAAW;oBACpD,UAAU;gBACZ;YACF;QACF;sCACA;QAAC;KAAW;IAGd,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;6BAAE;YACR,OAAO,gBAAgB,CAAC,aAAa;YACrC,OAAO,gBAAgB,CAAC,WAAW;YACnC;qCAAO;oBACL,OAAO,mBAAmB,CAAC,aAAa;oBACxC,OAAO,mBAAmB,CAAC,WAAW;gBACxC;;QACF;4BAAG;QAAC;QAAQ;KAAa;IAEzB,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;6BAAE;YACR,cAAc,OAAO,EAAE,eAAe;gBAAE,UAAU;YAAS;QAC7D;4BAAG;QAAC;KAAe;IAEnB,OAAO,eAAe,MAAM,GAAG,kBAC7B;;0BACE,6MAAC;gBACC,WAAU;gBACV,aAAa;gBACb,OAAO;oBAAE,QAAQ,SAAS;gBAAE;gBAC5B,MAAK;gBACL,iBAAe;;;;;;0BAGjB,6MAAC;gBACC,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EACV,wIACA;oBACE,eAAe;gBACjB;gBAEF,OAAO;oBAAE;gBAAO;;kCAEhB,6MAAC;wBAAI,WAAU;;0CACb,6MAAC;gCAAI,WAAU;;kDACb,6MAAC;wCAAI,WAAU;kDACb,cAAA,6MAAC,uHAAA,CAAA,qBAAkB;;;;;;;;;;kDAErB,6MAAC;kDAAI;;;;;;;;;;;;0CAEP,6MAAC,8HAAA,CAAA,SAAM;gCACL,SAAQ;gCACR,WAAU;gCACV,MAAK;gCACL,SAAS,IAAM,kBAAkB,EAAE;0CAEnC,cAAA,6MAAC,uHAAA,CAAA,iBAAc;;;;;;;;;;;;;;;;kCAInB,6MAAC;;4BACE,eAAe,GAAG,CAAC,CAAC,eAAe,sBAClC,6MAAC;oCAEC,WAAU;;sDAEV,6MAAC;4CACC,WAAW,CAAA,GAAA,+GAAA,CAAA,KAAE,AAAD,EAAE,iBAAiB;gDAC7B,yBACE,cAAc,MAAM,KAAK;gDAC3B,oBAAoB,cAAc,MAAM,KAAK;gDAC7C,gBAAgB,cAAc,MAAM,KAAK;4CAC3C;;gDACD;gDACG,QAAQ;gDAAE;;;;;;;wCAEb,cAAc,MAAM,KAAK,8BACxB,6MAAC;4CAAI,WAAU;sDACb,cAAA,6MAAC,uHAAA,CAAA,aAAU;;;;;;;;;iEAGb,6MAAC;4CAAI,WAAU;sDACZ,cAAc,OAAO;;;;;;;mCAnBrB,cAAc,EAAE;;;;;0CAwBzB,6MAAC;gCAAI,KAAK;;;;;;;;;;;;;;;;;;;uBAId;AACN;GA7GgB;KAAA"}},
    {"offset": {"line": 4980, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 4986, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/block.tsx"],"sourcesContent":["import type {\n  Attachment,\n  ChatRequestOptions,\n  CreateMessage,\n  Message,\n} from 'ai';\nimport { formatDistance } from 'date-fns';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport {\n  type Dispatch,\n  memo,\n  type SetStateAction,\n  useCallback,\n  useEffect,\n  useState,\n} from 'react';\nimport useSWR, { useSWRConfig } from 'swr';\nimport { useDebounceCallback, useWindowSize } from 'usehooks-ts';\n\nimport type { Document, Suggestion, Vote } from '@/lib/db/schema';\nimport { cn, fetcher } from '@/lib/utils';\n\nimport { DiffView } from './diffview';\nimport { DocumentSkeleton } from './document-skeleton';\nimport { Editor } from './editor';\nimport { MultimodalInput } from './multimodal-input';\nimport { Toolbar } from './toolbar';\nimport { VersionFooter } from './version-footer';\nimport { BlockActions } from './block-actions';\nimport { BlockCloseButton } from './block-close-button';\nimport { BlockMessages } from './block-messages';\nimport { CodeEditor } from './code-editor';\nimport { Console } from './console';\nimport { useSidebar } from './ui/sidebar';\nimport { useBlock } from '@/hooks/use-block';\nimport equal from 'fast-deep-equal';\n\nexport type BlockKind = 'text' | 'code';\n\nexport interface UIBlock {\n  title: string;\n  documentId: string;\n  kind: BlockKind;\n  content: string;\n  isVisible: boolean;\n  status: 'streaming' | 'idle';\n  boundingBox: {\n    top: number;\n    left: number;\n    width: number;\n    height: number;\n  };\n}\n\nexport interface ConsoleOutput {\n  id: string;\n  status: 'in_progress' | 'completed' | 'failed';\n  content: string | null;\n}\n\nfunction PureBlock({\n  chatId,\n  input,\n  setInput,\n  handleSubmit,\n  isLoading,\n  stop,\n  attachments,\n  setAttachments,\n  append,\n  messages,\n  setMessages,\n  reload,\n  votes,\n  isReadonly,\n}: {\n  chatId: string;\n  input: string;\n  setInput: (input: string) => void;\n  isLoading: boolean;\n  stop: () => void;\n  attachments: Array<Attachment>;\n  setAttachments: Dispatch<SetStateAction<Array<Attachment>>>;\n  messages: Array<Message>;\n  setMessages: Dispatch<SetStateAction<Array<Message>>>;\n  votes: Array<Vote> | undefined;\n  append: (\n    message: Message | CreateMessage,\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  handleSubmit: (\n    event?: {\n      preventDefault?: () => void;\n    },\n    chatRequestOptions?: ChatRequestOptions,\n  ) => void;\n  reload: (\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  isReadonly: boolean;\n}) {\n  const { block, setBlock } = useBlock();\n\n  const {\n    data: documents,\n    isLoading: isDocumentsFetching,\n    mutate: mutateDocuments,\n  } = useSWR<Array<Document>>(\n    block.documentId !== 'init' && block.status !== 'streaming'\n      ? `/api/document?id=${block.documentId}`\n      : null,\n    fetcher,\n  );\n\n  const { data: suggestions } = useSWR<Array<Suggestion>>(\n    documents && block && block.status !== 'streaming'\n      ? `/api/suggestions?documentId=${block.documentId}`\n      : null,\n    fetcher,\n    {\n      dedupingInterval: 5000,\n    },\n  );\n\n  const [mode, setMode] = useState<'edit' | 'diff'>('edit');\n  const [document, setDocument] = useState<Document | null>(null);\n  const [currentVersionIndex, setCurrentVersionIndex] = useState(-1);\n  const [consoleOutputs, setConsoleOutputs] = useState<Array<ConsoleOutput>>(\n    [],\n  );\n\n  const { open: isSidebarOpen } = useSidebar();\n\n  useEffect(() => {\n    if (documents && documents.length > 0) {\n      const mostRecentDocument = documents.at(-1);\n\n      if (mostRecentDocument) {\n        setDocument(mostRecentDocument);\n        setCurrentVersionIndex(documents.length - 1);\n        setBlock((currentBlock) => ({\n          ...currentBlock,\n          content: mostRecentDocument.content ?? '',\n        }));\n      }\n    }\n  }, [documents, setBlock]);\n\n  useEffect(() => {\n    mutateDocuments();\n  }, [block.status, mutateDocuments]);\n\n  const { mutate } = useSWRConfig();\n  const [isContentDirty, setIsContentDirty] = useState(false);\n\n  const handleContentChange = useCallback(\n    (updatedContent: string) => {\n      if (!block) return;\n\n      mutate<Array<Document>>(\n        `/api/document?id=${block.documentId}`,\n        async (currentDocuments) => {\n          if (!currentDocuments) return undefined;\n\n          const currentDocument = currentDocuments.at(-1);\n\n          if (!currentDocument || !currentDocument.content) {\n            setIsContentDirty(false);\n            return currentDocuments;\n          }\n\n          if (currentDocument.content !== updatedContent) {\n            await fetch(`/api/document?id=${block.documentId}`, {\n              method: 'POST',\n              body: JSON.stringify({\n                title: block.title,\n                content: updatedContent,\n                kind: block.kind,\n              }),\n            });\n\n            setIsContentDirty(false);\n\n            const newDocument = {\n              ...currentDocument,\n              content: updatedContent,\n              createdAt: new Date(),\n            };\n\n            return [...currentDocuments, newDocument];\n          }\n          return currentDocuments;\n        },\n        { revalidate: false },\n      );\n    },\n    [block, mutate],\n  );\n\n  const debouncedHandleContentChange = useDebounceCallback(\n    handleContentChange,\n    2000,\n  );\n\n  const saveContent = useCallback(\n    (updatedContent: string, debounce: boolean) => {\n      if (document && updatedContent !== document.content) {\n        setIsContentDirty(true);\n\n        if (debounce) {\n          debouncedHandleContentChange(updatedContent);\n        } else {\n          handleContentChange(updatedContent);\n        }\n      }\n    },\n    [document, debouncedHandleContentChange, handleContentChange],\n  );\n\n  function getDocumentContentById(index: number) {\n    if (!documents) return '';\n    if (!documents[index]) return '';\n    return documents[index].content ?? '';\n  }\n\n  const handleVersionChange = (type: 'next' | 'prev' | 'toggle' | 'latest') => {\n    if (!documents) return;\n\n    if (type === 'latest') {\n      setCurrentVersionIndex(documents.length - 1);\n      setMode('edit');\n    }\n\n    if (type === 'toggle') {\n      setMode((mode) => (mode === 'edit' ? 'diff' : 'edit'));\n    }\n\n    if (type === 'prev') {\n      if (currentVersionIndex > 0) {\n        setCurrentVersionIndex((index) => index - 1);\n      }\n    } else if (type === 'next') {\n      if (currentVersionIndex < documents.length - 1) {\n        setCurrentVersionIndex((index) => index + 1);\n      }\n    }\n  };\n\n  const [isToolbarVisible, setIsToolbarVisible] = useState(false);\n\n  /*\n   * NOTE: if there are no documents, or if\n   * the documents are being fetched, then\n   * we mark it as the current version.\n   */\n\n  const isCurrentVersion =\n    documents && documents.length > 0\n      ? currentVersionIndex === documents.length - 1\n      : true;\n\n  const { width: windowWidth, height: windowHeight } = useWindowSize();\n  const isMobile = windowWidth ? windowWidth < 768 : false;\n\n  return (\n    <AnimatePresence>\n      {block.isVisible && (\n        <motion.div\n          className=\"flex flex-row h-dvh w-dvw fixed top-0 left-0 z-50 bg-transparent\"\n          initial={{ opacity: 1 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0, transition: { delay: 0.4 } }}\n        >\n          {!isMobile && (\n            <motion.div\n              className=\"fixed bg-background h-dvh\"\n              initial={{\n                width: isSidebarOpen ? windowWidth - 256 : windowWidth,\n                right: 0,\n              }}\n              animate={{ width: windowWidth, right: 0 }}\n              exit={{\n                width: isSidebarOpen ? windowWidth - 256 : windowWidth,\n                right: 0,\n              }}\n            />\n          )}\n\n          {!isMobile && (\n            <motion.div\n              className=\"relative w-[400px] bg-muted dark:bg-background h-dvh shrink-0\"\n              initial={{ opacity: 0, x: 10, scale: 1 }}\n              animate={{\n                opacity: 1,\n                x: 0,\n                scale: 1,\n                transition: {\n                  delay: 0.2,\n                  type: 'spring',\n                  stiffness: 200,\n                  damping: 30,\n                },\n              }}\n              exit={{\n                opacity: 0,\n                x: 0,\n                scale: 1,\n                transition: { duration: 0 },\n              }}\n            >\n              <AnimatePresence>\n                {!isCurrentVersion && (\n                  <motion.div\n                    className=\"left-0 absolute h-dvh w-[400px] top-0 bg-zinc-900/50 z-50\"\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                  />\n                )}\n              </AnimatePresence>\n\n              <div className=\"flex flex-col h-full justify-between items-center gap-4\">\n                <BlockMessages\n                  chatId={chatId}\n                  isLoading={isLoading}\n                  votes={votes}\n                  messages={messages}\n                  setMessages={setMessages}\n                  reload={reload}\n                  isReadonly={isReadonly}\n                  blockStatus={block.status}\n                />\n\n                <form className=\"flex flex-row gap-2 relative items-end w-full px-4 pb-4\">\n                  <MultimodalInput\n                    chatId={chatId}\n                    input={input}\n                    setInput={setInput}\n                    handleSubmit={handleSubmit}\n                    isLoading={isLoading}\n                    stop={stop}\n                    attachments={attachments}\n                    setAttachments={setAttachments}\n                    messages={messages}\n                    append={append}\n                    className=\"bg-background dark:bg-muted\"\n                    setMessages={setMessages}\n                  />\n                </form>\n              </div>\n            </motion.div>\n          )}\n\n          <motion.div\n            className=\"fixed dark:bg-muted bg-background h-dvh flex flex-col overflow-y-scroll border-l dark:border-zinc-700 border-zinc-200\"\n            initial={\n              isMobile\n                ? {\n                    opacity: 1,\n                    x: block.boundingBox.left,\n                    y: block.boundingBox.top,\n                    height: block.boundingBox.height,\n                    width: block.boundingBox.width,\n                    borderRadius: 50,\n                  }\n                : {\n                    opacity: 1,\n                    x: block.boundingBox.left,\n                    y: block.boundingBox.top,\n                    height: block.boundingBox.height,\n                    width: block.boundingBox.width,\n                    borderRadius: 50,\n                  }\n            }\n            animate={\n              isMobile\n                ? {\n                    opacity: 1,\n                    x: 0,\n                    y: 0,\n                    height: windowHeight,\n                    width: windowWidth ? windowWidth : 'calc(100dvw)',\n                    borderRadius: 0,\n                    transition: {\n                      delay: 0,\n                      type: 'spring',\n                      stiffness: 200,\n                      damping: 30,\n                      duration: 5000,\n                    },\n                  }\n                : {\n                    opacity: 1,\n                    x: 400,\n                    y: 0,\n                    height: windowHeight,\n                    width: windowWidth\n                      ? windowWidth - 400\n                      : 'calc(100dvw-400px)',\n                    borderRadius: 0,\n                    transition: {\n                      delay: 0,\n                      type: 'spring',\n                      stiffness: 200,\n                      damping: 30,\n                      duration: 5000,\n                    },\n                  }\n            }\n            exit={{\n              opacity: 0,\n              scale: 0.5,\n              transition: {\n                delay: 0.1,\n                type: 'spring',\n                stiffness: 600,\n                damping: 30,\n              },\n            }}\n          >\n            <div className=\"p-2 flex flex-row justify-between items-start\">\n              <div className=\"flex flex-row gap-4 items-start\">\n                <BlockCloseButton />\n\n                <div className=\"flex flex-col\">\n                  <div className=\"font-medium\">\n                    {document?.title ?? block.title}\n                  </div>\n\n                  {isContentDirty ? (\n                    <div className=\"text-sm text-muted-foreground\">\n                      Saving changes...\n                    </div>\n                  ) : document ? (\n                    <div className=\"text-sm text-muted-foreground\">\n                      {`Updated ${formatDistance(\n                        new Date(document.createdAt),\n                        new Date(),\n                        {\n                          addSuffix: true,\n                        },\n                      )}`}\n                    </div>\n                  ) : (\n                    <div className=\"w-32 h-3 mt-2 bg-muted-foreground/20 rounded-md animate-pulse\" />\n                  )}\n                </div>\n              </div>\n\n              <BlockActions\n                block={block}\n                currentVersionIndex={currentVersionIndex}\n                handleVersionChange={handleVersionChange}\n                isCurrentVersion={isCurrentVersion}\n                mode={mode}\n                setConsoleOutputs={setConsoleOutputs}\n              />\n            </div>\n\n            <div\n              className={cn(\n                'dark:bg-muted bg-background h-full overflow-y-scroll !max-w-full pb-40 items-center',\n                {\n                  'py-2 px-2': block.kind === 'code',\n                  'py-8 md:p-20 px-4': block.kind === 'text',\n                },\n              )}\n            >\n              <div\n                className={cn('flex flex-row', {\n                  '': block.kind === 'code',\n                  'mx-auto max-w-[600px]': block.kind === 'text',\n                })}\n              >\n                {isDocumentsFetching && !block.content ? (\n                  <DocumentSkeleton />\n                ) : block.kind === 'code' ? (\n                  <CodeEditor\n                    content={\n                      isCurrentVersion\n                        ? block.content\n                        : getDocumentContentById(currentVersionIndex)\n                    }\n                    isCurrentVersion={isCurrentVersion}\n                    currentVersionIndex={currentVersionIndex}\n                    suggestions={suggestions ?? []}\n                    status={block.status}\n                    saveContent={saveContent}\n                  />\n                ) : block.kind === 'text' ? (\n                  mode === 'edit' ? (\n                    <Editor\n                      content={\n                        isCurrentVersion\n                          ? block.content\n                          : getDocumentContentById(currentVersionIndex)\n                      }\n                      isCurrentVersion={isCurrentVersion}\n                      currentVersionIndex={currentVersionIndex}\n                      status={block.status}\n                      saveContent={saveContent}\n                      suggestions={isCurrentVersion ? (suggestions ?? []) : []}\n                    />\n                  ) : (\n                    <DiffView\n                      oldContent={getDocumentContentById(\n                        currentVersionIndex - 1,\n                      )}\n                      newContent={getDocumentContentById(currentVersionIndex)}\n                    />\n                  )\n                ) : null}\n\n                {suggestions ? (\n                  <div className=\"md:hidden h-dvh w-12 shrink-0\" />\n                ) : null}\n\n                <AnimatePresence>\n                  {isCurrentVersion && (\n                    <Toolbar\n                      isToolbarVisible={isToolbarVisible}\n                      setIsToolbarVisible={setIsToolbarVisible}\n                      append={append}\n                      isLoading={isLoading}\n                      stop={stop}\n                      setMessages={setMessages}\n                      blockKind={block.kind}\n                    />\n                  )}\n                </AnimatePresence>\n              </div>\n            </div>\n\n            <AnimatePresence>\n              {!isCurrentVersion && (\n                <VersionFooter\n                  currentVersionIndex={currentVersionIndex}\n                  documents={documents}\n                  handleVersionChange={handleVersionChange}\n                />\n              )}\n            </AnimatePresence>\n\n            <AnimatePresence>\n              <Console\n                consoleOutputs={consoleOutputs}\n                setConsoleOutputs={setConsoleOutputs}\n              />\n            </AnimatePresence>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\nexport const Block = memo(PureBlock, (prevProps, nextProps) => {\n  if (prevProps.isLoading !== nextProps.isLoading) return false;\n  if (!equal(prevProps.votes, nextProps.votes)) return false;\n  if (prevProps.input !== nextProps.input) return false;\n  if (!equal(prevProps.messages, nextProps.messages.length)) return false;\n\n  return true;\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5591, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5597, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/messages.tsx"],"sourcesContent":["import { ChatRequestOptions, Message } from 'ai';\nimport { PreviewMessage, ThinkingMessage } from './message';\nimport { useScrollToBottom } from './use-scroll-to-bottom';\nimport { Overview } from './overview';\nimport { memo } from 'react';\nimport { Vote } from '@/lib/db/schema';\nimport equal from 'fast-deep-equal';\n\ninterface MessagesProps {\n  chatId: string;\n  isLoading: boolean;\n  votes: Array<Vote> | undefined;\n  messages: Array<Message>;\n  setMessages: (\n    messages: Message[] | ((messages: Message[]) => Message[]),\n  ) => void;\n  reload: (\n    chatRequestOptions?: ChatRequestOptions,\n  ) => Promise<string | null | undefined>;\n  isReadonly: boolean;\n  isBlockVisible: boolean;\n}\n\nfunction PureMessages({\n  chatId,\n  isLoading,\n  votes,\n  messages,\n  setMessages,\n  reload,\n  isReadonly,\n}: MessagesProps) {\n  const [messagesContainerRef, messagesEndRef] =\n    useScrollToBottom<HTMLDivElement>();\n\n  return (\n    <div\n      ref={messagesContainerRef}\n      className=\"flex flex-col min-w-0 gap-6 flex-1 overflow-y-scroll pt-4\"\n    >\n      {/* {messages.length === 0 && <Overview />} */}\n\n      {messages.map((message, index) => (\n        <PreviewMessage\n          key={message.id}\n          chatId={chatId}\n          message={message}\n          isLoading={isLoading && messages.length - 1 === index}\n          vote={\n            votes\n              ? votes.find((vote) => vote.messageId === message.id)\n              : undefined\n          }\n          setMessages={setMessages}\n          reload={reload}\n          isReadonly={isReadonly}\n        />\n      ))}\n\n      {isLoading &&\n        messages.length > 0 &&\n        messages[messages.length - 1].role === 'user' && <ThinkingMessage />}\n\n      <div\n        ref={messagesEndRef}\n        className=\"shrink-0 min-w-[24px] min-h-[24px]\"\n      />\n    </div>\n  );\n}\n\nexport const Messages = memo(PureMessages, (prevProps, nextProps) => {\n  if (prevProps.isBlockVisible && nextProps.isBlockVisible) return true;\n\n  if (prevProps.isLoading !== nextProps.isLoading) return false;\n  if (prevProps.isLoading && nextProps.isLoading) return false;\n  if (prevProps.messages.length !== nextProps.messages.length) return false;\n  if (!equal(prevProps.votes, nextProps.votes)) return false;\n\n  return true;\n});\n"],"names":[],"mappings":";;;;AACA;AACA;AAEA;AAEA;;;;;;;AAiBA,SAAS,aAAa,EACpB,MAAM,EACN,SAAS,EACT,KAAK,EACL,QAAQ,EACR,WAAW,EACX,MAAM,EACN,UAAU,EACI;;IACd,MAAM,CAAC,sBAAsB,eAAe,GAC1C,CAAA,GAAA,8IAAA,CAAA,oBAAiB,AAAD;IAElB,qBACE,6MAAC;QACC,KAAK;QACL,WAAU;;YAIT,SAAS,GAAG,CAAC,CAAC,SAAS,sBACtB,6MAAC,yHAAA,CAAA,iBAAc;oBAEb,QAAQ;oBACR,SAAS;oBACT,WAAW,aAAa,SAAS,MAAM,GAAG,MAAM;oBAChD,MACE,QACI,MAAM,IAAI,CAAC,CAAC,OAAS,KAAK,SAAS,KAAK,QAAQ,EAAE,IAClD;oBAEN,aAAa;oBACb,QAAQ;oBACR,YAAY;mBAXP,QAAQ,EAAE;;;;;YAelB,aACC,SAAS,MAAM,GAAG,KAClB,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,CAAC,IAAI,KAAK,wBAAU,6MAAC,yHAAA,CAAA,kBAAe;;;;;0BAEnE,6MAAC;gBACC,KAAK;gBACL,WAAU;;;;;;;;;;;;AAIlB;GA9CS;;QAUL,8IAAA,CAAA,oBAAiB;;;KAVZ;AAgDF,MAAM,yBAAW,CAAA,GAAA,6KAAA,CAAA,OAAI,AAAD,EAAE,cAAc,CAAC,WAAW;IACrD,IAAI,UAAU,cAAc,IAAI,UAAU,cAAc,EAAE,OAAO;IAEjE,IAAI,UAAU,SAAS,KAAK,UAAU,SAAS,EAAE,OAAO;IACxD,IAAI,UAAU,SAAS,IAAI,UAAU,SAAS,EAAE,OAAO;IACvD,IAAI,UAAU,QAAQ,CAAC,MAAM,KAAK,UAAU,QAAQ,CAAC,MAAM,EAAE,OAAO;IACpE,IAAI,CAAC,CAAA,GAAA,iJAAA,CAAA,UAAK,AAAD,EAAE,UAAU,KAAK,EAAE,UAAU,KAAK,GAAG,OAAO;IAErD,OAAO;AACT"}},
    {"offset": {"line": 5672, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5678, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/chat.tsx"],"sourcesContent":["'use client';\n\nimport type { Attachment, Message } from 'ai';\nimport { useChat } from 'ai/react';\nimport { useState } from 'react';\nimport useSWR, { useSWRConfig } from 'swr';\n\nimport { ChatHeader } from '@/components/chat-header';\nimport type { Vote } from '@/lib/db/schema';\nimport { fetcher } from '@/lib/utils';\n\nimport { Block } from './block';\nimport { MultimodalInput } from './multimodal-input';\nimport { Messages } from './messages';\nimport { VisibilityType } from './visibility-selector';\nimport { useBlockSelector } from '@/hooks/use-block';\n\nexport function Chat({\n  id,\n  initialMessages,\n  selectedModelId,\n  selectedVisibilityType,\n  isReadonly,\n}: {\n  id: string;\n  initialMessages: Array<Message>;\n  selectedModelId: string;\n  selectedVisibilityType: VisibilityType;\n  isReadonly: boolean;\n}) {\n  const { mutate } = useSWRConfig();\n\n  const {\n    messages,\n    setMessages,\n    handleSubmit,\n    input,\n    setInput,\n    append,\n    isLoading,\n    stop,\n    reload,\n  } = useChat({\n    id,\n    body: { id, modelId: selectedModelId },\n    initialMessages,\n    experimental_throttle: 100,\n    onFinish: () => {\n      mutate('/api/history');\n    },\n  });\n\n  const { data: votes } = useSWR<Array<Vote>>(\n    `/api/vote?chatId=${id}`,\n    fetcher,\n  );\n\n  const [attachments, setAttachments] = useState<Array<Attachment>>([]);\n  const isBlockVisible = useBlockSelector((state) => state.isVisible);\n\n  return (\n    <>\n      <div className=\"flex flex-col min-w-0 h-dvh bg-background\">\n        <ChatHeader\n          chatId={id}\n          selectedModelId={selectedModelId}\n          selectedVisibilityType={selectedVisibilityType}\n          isReadonly={isReadonly}\n        />\n\n        <Messages\n          chatId={id}\n          isLoading={isLoading}\n          votes={votes}\n          messages={messages}\n          setMessages={setMessages}\n          reload={reload}\n          isReadonly={isReadonly}\n          isBlockVisible={isBlockVisible}\n        />\n\n        <form className=\"flex mx-auto px-4 bg-background pb-4 md:pb-6 gap-2 w-full md:max-w-3xl\">\n          {!isReadonly && (\n            <MultimodalInput\n              chatId={id}\n              input={input}\n              setInput={setInput}\n              handleSubmit={handleSubmit}\n              isLoading={isLoading}\n              stop={stop}\n              attachments={attachments}\n              setAttachments={setAttachments}\n              messages={messages}\n              setMessages={setMessages}\n              append={append}\n            />\n          )}\n        </form>\n      </div>\n\n      <Block\n        chatId={id}\n        input={input}\n        setInput={setInput}\n        handleSubmit={handleSubmit}\n        isLoading={isLoading}\n        stop={stop}\n        attachments={attachments}\n        setAttachments={setAttachments}\n        append={append}\n        messages={messages}\n        setMessages={setMessages}\n        reload={reload}\n        votes={votes}\n        isReadonly={isReadonly}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;AAIA;AAGA;AAEA;AAEA;AACA;AACA;AAEA;AAVA;AAFA;AAEA;;;AALA;;;;;;;;;;AAiBO,SAAS,KAAK,EACnB,EAAE,EACF,eAAe,EACf,eAAe,EACf,sBAAsB,EACtB,UAAU,EAOX;;IACC,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,qKAAA,CAAA,eAAY,AAAD;IAE9B,MAAM,EACJ,QAAQ,EACR,WAAW,EACX,YAAY,EACZ,KAAK,EACL,QAAQ,EACR,MAAM,EACN,SAAS,EACT,IAAI,EACJ,MAAM,EACP,GAAG,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD,EAAE;QACV;QACA,MAAM;YAAE;YAAI,SAAS;QAAgB;QACrC;QACA,uBAAuB;QACvB,QAAQ;4BAAE;gBACR,OAAO;YACT;;IACF;IAEA,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,CAAA,GAAA,iKAAA,CAAA,UAAM,AAAD,EAC3B,CAAC,iBAAiB,EAAE,IAAI,EACxB,+GAAA,CAAA,UAAO;IAGT,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6KAAA,CAAA,WAAQ,AAAD,EAAqB,EAAE;IACpE,MAAM,iBAAiB,CAAA,GAAA,wHAAA,CAAA,mBAAgB,AAAD;iDAAE,CAAC,QAAU,MAAM,SAAS;;IAElE,qBACE;;0BACE,6MAAC;gBAAI,WAAU;;kCACb,6MAAC,gIAAA,CAAA,aAAU;wBACT,QAAQ;wBACR,iBAAiB;wBACjB,wBAAwB;wBACxB,YAAY;;;;;;kCAGd,6MAAC,0HAAA,CAAA,WAAQ;wBACP,QAAQ;wBACR,WAAW;wBACX,OAAO;wBACP,UAAU;wBACV,aAAa;wBACb,QAAQ;wBACR,YAAY;wBACZ,gBAAgB;;;;;;kCAGlB,6MAAC;wBAAK,WAAU;kCACb,CAAC,4BACA,6MAAC,qIAAA,CAAA,kBAAe;4BACd,QAAQ;4BACR,OAAO;4BACP,UAAU;4BACV,cAAc;4BACd,WAAW;4BACX,MAAM;4BACN,aAAa;4BACb,gBAAgB;4BAChB,UAAU;4BACV,aAAa;4BACb,QAAQ;;;;;;;;;;;;;;;;;0BAMhB,6MAAC,uHAAA,CAAA,QAAK;gBACJ,QAAQ;gBACR,OAAO;gBACP,UAAU;gBACV,cAAc;gBACd,WAAW;gBACX,MAAM;gBACN,aAAa;gBACb,gBAAgB;gBAChB,QAAQ;gBACR,UAAU;gBACV,aAAa;gBACb,QAAQ;gBACR,OAAO;gBACP,YAAY;;;;;;;;AAIpB;GArGgB;;QAaK,qKAAA,CAAA,eAAY;QAY3B,gJAAA,CAAA,UAAO;QAUa,iKAAA,CAAA,UAAM;QAMP,wHAAA,CAAA,mBAAgB;;;KAzCzB"}},
    {"offset": {"line": 5822, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 5828, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/danie/source/repos/StarTraderTest/components/data-stream-handler.tsx"],"sourcesContent":["'use client';\n\nimport { useChat } from 'ai/react';\nimport { useEffect, useRef } from 'react';\nimport { BlockKind } from './block';\nimport { Suggestion } from '@/lib/db/schema';\nimport { initialBlockData, useBlock } from '@/hooks/use-block';\nimport { useUserMessageId } from '@/hooks/use-user-message-id';\nimport { cx } from 'class-variance-authority';\n\ntype DataStreamDelta = {\n  type:\n    | 'text-delta'\n    | 'code-delta'\n    | 'title'\n    | 'id'\n    | 'suggestion'\n    | 'clear'\n    | 'finish'\n    | 'user-message-id'\n    | 'kind';\n  content: string | Suggestion;\n};\n\nexport function DataStreamHandler({ id }: { id: string }) {\n  const { data: dataStream } = useChat({ id });\n  const { setUserMessageIdFromServer } = useUserMessageId();\n  const { setBlock } = useBlock();\n  const lastProcessedIndex = useRef(-1);\n\n  useEffect(() => {\n    if (!dataStream?.length) return;\n\n    const newDeltas = dataStream.slice(lastProcessedIndex.current + 1);\n    lastProcessedIndex.current = dataStream.length - 1;\n\n    (newDeltas as DataStreamDelta[]).forEach((delta: DataStreamDelta) => {\n      if (delta.type === 'user-message-id') {\n        setUserMessageIdFromServer(delta.content as string);\n        return;\n      }\n\n      setBlock((draftBlock) => {\n        if (!draftBlock) {\n          return { ...initialBlockData, status: 'streaming' };\n        }\n\n        switch (delta.type) {\n          case 'id':\n            return {\n              ...draftBlock,\n              documentId: delta.content as string,\n              status: 'streaming',\n            };\n\n          case 'title':\n            return {\n              ...draftBlock,\n              title: delta.content as string,\n              status: 'streaming',\n            };\n\n          case 'kind':\n            return {\n              ...draftBlock,\n              kind: delta.content as BlockKind,\n              status: 'streaming',\n            };\n\n          case 'text-delta':\n            return {\n              ...draftBlock,\n              content: draftBlock.content + (delta.content as string),\n              isVisible:\n                draftBlock.status === 'streaming' &&\n                draftBlock.content.length > 400 &&\n                draftBlock.content.length < 450\n                  ? true\n                  : draftBlock.isVisible,\n              status: 'streaming',\n            };\n\n          case 'code-delta':\n            return {\n              ...draftBlock,\n              content: delta.content as string,\n              isVisible:\n                draftBlock.status === 'streaming' &&\n                draftBlock.content.length > 300 &&\n                draftBlock.content.length < 310\n                  ? true\n                  : draftBlock.isVisible,\n              status: 'streaming',\n            };\n\n          case 'clear':\n            return {\n              ...draftBlock,\n              content: '',\n              status: 'streaming',\n            };\n\n          case 'finish':\n            return {\n              ...draftBlock,\n              status: 'idle',\n            };\n\n          default:\n            return draftBlock;\n        }\n      });\n    });\n  }, [dataStream, setBlock, setUserMessageIdFromServer]);\n\n  return null;\n}\n"],"names":[],"mappings":";;;AAGA;AAGA;AACA;AALA;;AAFA;;;;;AAwBO,SAAS,kBAAkB,EAAE,EAAE,EAAkB;;IACtD,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,CAAA,GAAA,gJAAA,CAAA,UAAO,AAAD,EAAE;QAAE;IAAG;IAC1C,MAAM,EAAE,0BAA0B,EAAE,GAAG,CAAA,GAAA,wIAAA,CAAA,mBAAgB,AAAD;IACtD,MAAM,EAAE,QAAQ,EAAE,GAAG,CAAA,GAAA,wHAAA,CAAA,WAAQ,AAAD;IAC5B,MAAM,qBAAqB,CAAA,GAAA,6KAAA,CAAA,SAAM,AAAD,EAAE,CAAC;IAEnC,CAAA,GAAA,6KAAA,CAAA,YAAS,AAAD;uCAAE;YACR,IAAI,CAAC,YAAY,QAAQ;YAEzB,MAAM,YAAY,WAAW,KAAK,CAAC,mBAAmB,OAAO,GAAG;YAChE,mBAAmB,OAAO,GAAG,WAAW,MAAM,GAAG;YAEhD,UAAgC,OAAO;+CAAC,CAAC;oBACxC,IAAI,MAAM,IAAI,KAAK,mBAAmB;wBACpC,2BAA2B,MAAM,OAAO;wBACxC;oBACF;oBAEA;uDAAS,CAAC;4BACR,IAAI,CAAC,YAAY;gCACf,OAAO;oCAAE,GAAG,wHAAA,CAAA,mBAAgB;oCAAE,QAAQ;gCAAY;4BACpD;4BAEA,OAAQ,MAAM,IAAI;gCAChB,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,YAAY,MAAM,OAAO;wCACzB,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,OAAO,MAAM,OAAO;wCACpB,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,MAAM,MAAM,OAAO;wCACnB,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,SAAS,WAAW,OAAO,GAAI,MAAM,OAAO;wCAC5C,WACE,WAAW,MAAM,KAAK,eACtB,WAAW,OAAO,CAAC,MAAM,GAAG,OAC5B,WAAW,OAAO,CAAC,MAAM,GAAG,MACxB,OACA,WAAW,SAAS;wCAC1B,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,SAAS,MAAM,OAAO;wCACtB,WACE,WAAW,MAAM,KAAK,eACtB,WAAW,OAAO,CAAC,MAAM,GAAG,OAC5B,WAAW,OAAO,CAAC,MAAM,GAAG,MACxB,OACA,WAAW,SAAS;wCAC1B,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,SAAS;wCACT,QAAQ;oCACV;gCAEF,KAAK;oCACH,OAAO;wCACL,GAAG,UAAU;wCACb,QAAQ;oCACV;gCAEF;oCACE,OAAO;4BACX;wBACF;;gBACF;;QACF;sCAAG;QAAC;QAAY;QAAU;KAA2B;IAErD,OAAO;AACT;GA5FgB;;QACe,gJAAA,CAAA,UAAO;QACG,wIAAA,CAAA,mBAAgB;QAClC,wHAAA,CAAA,WAAQ;;;KAHf"}},
    {"offset": {"line": 5940, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}